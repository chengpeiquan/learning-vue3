<!DOCTYPE html>
<html lang="zh-CN" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>插件的开发和使用 | Vue3 入门指南与实战案例</title>
    <meta name="description" content="这是一个关于 Vue 3 + TypeScript 的起步学习教程，适合完全的 Vue 新手和 Vue 2.0 的老手，在官方文档的基础上融入自己的一些实践经验。">
    <link rel="preload stylesheet" href="/assets/style.32aeed65.css" as="style">
    
    <script type="module" src="/assets/app.be944f7f.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.2ed14f66.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/framework.391e82f5.js">
    <link rel="modulepreload" href="/assets/chunks/theme.9bfe0304.js">
    <link rel="modulepreload" href="/assets/plugin.md.0a2dbef2.lean.js">
    <link rel="icon" href="https://chengpeiquan.com/favicon.ico">
    <meta name="keywords" content="Vue3, Vue3.x, Vue3入门, Vue3教程, 学习Vue3, Vue3案例, Vue3教学, Vue3好用吗, Vue3怎么学, 前端工程化, 前端工程化：基于Vue.js 3.0的设计与实践">
    <script id="check-dark-light">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"dark",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-2751e8a7><!--[--><!--]--><!--[--><span tabindex="-1" data-v-4fe43edc></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-4fe43edc> Skip to content </a><!--]--><!----><header class="VPNav" data-v-2751e8a7 data-v-5f0607de><div class="VPNavBar has-sidebar" data-v-5f0607de data-v-285e0a80><div class="container" data-v-285e0a80><div class="title" data-v-285e0a80><div class="VPNavBarTitle has-sidebar" data-v-285e0a80 data-v-585e0129><a class="title" href="/" data-v-585e0129><!--[--><!--]--><!----><!--[-->Vue3 入门指南与实战案例<!--]--><!--[--><!--]--></a></div></div><div class="content" data-v-285e0a80><div class="curtain" data-v-285e0a80></div><div class="content-body" data-v-285e0a80><!--[--><!--]--><div class="VPNavBarSearch search" style="--vp-meta-key:&#39;Meta&#39;;" data-v-285e0a80><!--[--><!----><div id="docsearch"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg class="DocSearch-Search-Icon" width="20" height="20" viewBox="0 0 20 20" aria-label="search icon"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-285e0a80 data-v-2d44fd3a><span id="main-nav-aria-label" class="visually-hidden" data-v-2d44fd3a>Main Navigation</span><!--[--><!--[--><a class="VPLink link vp-external-link-icon VPNavBarMenuLink" href="https://union-click.jd.com/jdc?e=jdext-1638352360249409536-0-1&amp;p=JF8BARkJK1olXwQBUVpdAE8SAF8IGVMRXgICV24ZVxNJXF9RXh5UHw0cSgYYXBcIWDoXSQVJQwYAXFpeDEsUHDZNRwYlX1JEIQg5XCt0ZAlqUiVNX0FQACsWTkcbM28BG1kdXAcCU11tCEoWA2sNGFgTXDYyVFttWiXPtdnQvuoJiayNgdbKOEonA2gBGVkdXwEHVFdeAXsXC2s4zfWBiI69je743uG51uK4ztK-ibiEZG5tC3tMVjtBXkcVWgQLVlpeCkwWAGoAHlodWQQFSF9BCHsXAm4KE1gWWgQGOltdCUoVAGoBElh7XwcDVltdDksXAV8IK1glA2gDB1heWkweVgFVQgkdX00BHTBdDUgXAW4OHF8lXwcDVlxtOA" target="_blank" rel="noreferrer" tabindex="0" data-v-2d44fd3a data-v-a4e4d10e><!--[-->购买纸质版<!--]--></a><!--]--><!--[--><a class="VPLink link vp-external-link-icon VPNavBarMenuLink" href="https://chengpeiquan.com/" target="_blank" rel="noreferrer" tabindex="0" data-v-2d44fd3a data-v-a4e4d10e><!--[-->博客首页<!--]--></a><!--]--><!--[--><a class="VPLink link vp-external-link-icon VPNavBarMenuLink" href="https://github.com/chengpeiquan/cooking-cookbook" target="_blank" rel="noreferrer" tabindex="0" data-v-2d44fd3a data-v-a4e4d10e><!--[-->菜谱教程<!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-285e0a80 data-v-be728888><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="toggle dark mode" aria-checked="false" data-v-be728888 data-v-e10818ea data-v-653b820a><span class="check" data-v-653b820a><span class="icon" data-v-653b820a><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-e10818ea><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-e10818ea><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-285e0a80 data-v-61b92425 data-v-4fd19001><!--[--><a class="VPSocialLink no-icon" href="https://github.com/chengpeiquan/learning-vue3" aria-label="github" target="_blank" rel="noopener" data-v-4fd19001 data-v-fa50c517><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-285e0a80 data-v-6efddd50 data-v-4f136dbe><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-4f136dbe><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-4f136dbe><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-4f136dbe><div class="VPMenu" data-v-4f136dbe data-v-f1daca7c><!----><!--[--><!--[--><!----><div class="group" data-v-6efddd50><div class="item appearance" data-v-6efddd50><p class="label" data-v-6efddd50>Appearance</p><div class="appearance-action" data-v-6efddd50><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="toggle dark mode" aria-checked="false" data-v-6efddd50 data-v-e10818ea data-v-653b820a><span class="check" data-v-653b820a><span class="icon" data-v-653b820a><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-e10818ea><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-e10818ea><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><div class="group" data-v-6efddd50><div class="item social-links" data-v-6efddd50><div class="VPSocialLinks social-links-list" data-v-6efddd50 data-v-4fd19001><!--[--><a class="VPSocialLink no-icon" href="https://github.com/chengpeiquan/learning-vue3" aria-label="github" target="_blank" rel="noopener" data-v-4fd19001 data-v-fa50c517><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-285e0a80 data-v-cd1434dd><span class="container" data-v-cd1434dd><span class="top" data-v-cd1434dd></span><span class="middle" data-v-cd1434dd></span><span class="bottom" data-v-cd1434dd></span></span></button></div></div></div></div><!----></header><div class="VPLocalNav reached-top" data-v-2751e8a7 data-v-f4215cba><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-f4215cba><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="menu-icon" data-v-f4215cba><path d="M17,11H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,11,17,11z"></path><path d="M21,7H3C2.4,7,2,6.6,2,6s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,7,21,7z"></path><path d="M21,15H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h18c0.6,0,1,0.4,1,1S21.6,15,21,15z"></path><path d="M17,19H3c-0.6,0-1-0.4-1-1s0.4-1,1-1h14c0.6,0,1,0.4,1,1S17.6,19,17,19z"></path></svg><span class="menu-text" data-v-f4215cba>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-f4215cba data-v-cc10b9f7><button data-v-cc10b9f7>Return to top</button><!----></div></div><aside class="VPSidebar" data-v-2751e8a7 data-v-baf6bbc8><div class="curtain" data-v-baf6bbc8></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-baf6bbc8><span class="visually-hidden" id="sidebar-aria-label" data-v-baf6bbc8> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="group" data-v-baf6bbc8><section class="VPSidebarItem level-0" data-v-baf6bbc8 data-v-36baaa93><div class="item" role="button" tabindex="0" data-v-36baaa93><div class="indicator" data-v-36baaa93></div><h2 class="text" data-v-36baaa93>作者的话</h2><!----></div><div class="items" data-v-36baaa93><!--[--><div class="VPSidebarItem level-1 is-link" data-v-36baaa93 data-v-36baaa93><div class="item" data-v-36baaa93><div class="indicator" data-v-36baaa93></div><a class="VPLink link link" href="/" data-v-36baaa93><!--[--><p class="text" data-v-36baaa93>出版说明</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-36baaa93 data-v-36baaa93><div class="item" data-v-36baaa93><div class="indicator" data-v-36baaa93></div><a class="VPLink link link" href="/preface.html" data-v-36baaa93><!--[--><p class="text" data-v-36baaa93>前言</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-baf6bbc8><section class="VPSidebarItem level-0" data-v-baf6bbc8 data-v-36baaa93><div class="item" role="button" tabindex="0" data-v-36baaa93><div class="indicator" data-v-36baaa93></div><h2 class="text" data-v-36baaa93>前端工程化入门教程</h2><!----></div><div class="items" data-v-36baaa93><!--[--><div class="VPSidebarItem level-1 is-link" data-v-36baaa93 data-v-36baaa93><div class="item" data-v-36baaa93><div class="indicator" data-v-36baaa93></div><a class="VPLink link link" href="/engineering.html" data-v-36baaa93><!--[--><p class="text" data-v-36baaa93>了解前端工程化</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-36baaa93 data-v-36baaa93><div class="item" data-v-36baaa93><div class="indicator" data-v-36baaa93></div><a class="VPLink link link" href="/guide.html" data-v-36baaa93><!--[--><p class="text" data-v-36baaa93>工程化的前期准备</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-36baaa93 data-v-36baaa93><div class="item" data-v-36baaa93><div class="indicator" data-v-36baaa93></div><a class="VPLink link link" href="/typescript.html" data-v-36baaa93><!--[--><p class="text" data-v-36baaa93>快速上手 TypeScript</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-baf6bbc8><section class="VPSidebarItem level-0 has-active" data-v-baf6bbc8 data-v-36baaa93><div class="item" role="button" tabindex="0" data-v-36baaa93><div class="indicator" data-v-36baaa93></div><h2 class="text" data-v-36baaa93>Vue3 入门教程</h2><!----></div><div class="items" data-v-36baaa93><!--[--><div class="VPSidebarItem level-1 is-link" data-v-36baaa93 data-v-36baaa93><div class="item" data-v-36baaa93><div class="indicator" data-v-36baaa93></div><a class="VPLink link link" href="/upgrade.html" data-v-36baaa93><!--[--><p class="text" data-v-36baaa93>脚手架的升级与配置</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-36baaa93 data-v-36baaa93><div class="item" data-v-36baaa93><div class="indicator" data-v-36baaa93></div><a class="VPLink link link" href="/component.html" data-v-36baaa93><!--[--><p class="text" data-v-36baaa93>单组件的编写</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-36baaa93 data-v-36baaa93><div class="item" data-v-36baaa93><div class="indicator" data-v-36baaa93></div><a class="VPLink link link" href="/router.html" data-v-36baaa93><!--[--><p class="text" data-v-36baaa93>路由的使用</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link is-active has-active" data-v-36baaa93 data-v-36baaa93><div class="item" data-v-36baaa93><div class="indicator" data-v-36baaa93></div><a class="VPLink link link" href="/plugin.html" data-v-36baaa93><!--[--><p class="text" data-v-36baaa93>插件的开发和使用</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-36baaa93 data-v-36baaa93><div class="item" data-v-36baaa93><div class="indicator" data-v-36baaa93></div><a class="VPLink link link" href="/communication.html" data-v-36baaa93><!--[--><p class="text" data-v-36baaa93>组件之间的通信</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-36baaa93 data-v-36baaa93><div class="item" data-v-36baaa93><div class="indicator" data-v-36baaa93></div><a class="VPLink link link" href="/pinia.html" data-v-36baaa93><!--[--><p class="text" data-v-36baaa93>全局状态的管理</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-36baaa93 data-v-36baaa93><div class="item" data-v-36baaa93><div class="indicator" data-v-36baaa93></div><a class="VPLink link link" href="/efficient.html" data-v-36baaa93><!--[--><p class="text" data-v-36baaa93>高效开发</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-baf6bbc8><section class="VPSidebarItem level-0" data-v-baf6bbc8 data-v-36baaa93><div class="item" role="button" tabindex="0" data-v-36baaa93><div class="indicator" data-v-36baaa93></div><h2 class="text" data-v-36baaa93>扩展阅读</h2><!----></div><div class="items" data-v-36baaa93><!--[--><div class="VPSidebarItem level-1 is-link" data-v-36baaa93 data-v-36baaa93><div class="item" data-v-36baaa93><div class="indicator" data-v-36baaa93></div><a class="VPLink link link" href="/links.html" data-v-36baaa93><!--[--><p class="text" data-v-36baaa93>常用文档</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-36baaa93 data-v-36baaa93><div class="item" data-v-36baaa93><div class="indicator" data-v-36baaa93></div><a class="VPLink link link" href="/changelog.html" data-v-36baaa93><!--[--><p class="text" data-v-36baaa93>更新记录</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-2751e8a7 data-v-1869d27b><div class="VPDoc has-sidebar has-aside" data-v-1869d27b data-v-f5bb20f4><!--[--><!--]--><div class="container" data-v-f5bb20f4><div class="aside" data-v-f5bb20f4><div class="aside-curtain" data-v-f5bb20f4></div><div class="aside-container" data-v-f5bb20f4><div class="aside-content" data-v-f5bb20f4><div class="VPDocAside" data-v-f5bb20f4 data-v-d1251778><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline" data-v-d1251778 data-v-bdb47eaf><div class="content" data-v-bdb47eaf><div class="outline-marker" data-v-bdb47eaf></div><div class="outline-title" data-v-bdb47eaf>目录</div><nav aria-labelledby="doc-outline-aria-label" data-v-bdb47eaf><span class="visually-hidden" id="doc-outline-aria-label" data-v-bdb47eaf> Table of Contents for current page </span><ul class="root" data-v-bdb47eaf data-v-786e2aa6><!--[--><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-d1251778></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-f5bb20f4><div class="content-container" data-v-f5bb20f4><!--[--><!--]--><!----><main class="main" data-v-f5bb20f4><div style="position:relative;" class="vp-doc _plugin" data-v-f5bb20f4><div><h1 id="插件的开发和使用" tabindex="-1">插件的开发和使用 <a class="header-anchor" href="#插件的开发和使用" aria-label="Permalink to &quot;插件的开发和使用&quot;">​</a></h1><p>在构建 Vue 项目的过程中，离不开各种开箱即用的插件支持，用以快速完成需求，避免自己造轮子。</p><p>在 Vue 项目里，可以使用针对 Vue 定制开发的专属插件，也可以使用无框架依赖的通用 JS 插件，插件的表现形式也是丰富多彩，既可以是功能的实现，也可以是组件的封装，本章将从插件的使用到亲自开发一个小插件的过程，逐一讲解。</p><div><h2 id="温馨提示" tabindex="-1">温馨提示 <a class="header-anchor" href="#温馨提示" aria-label="Permalink to &quot;温馨提示&quot;">​</a></h2><p>这是笔者写于 2024-02-20 的补充提示，为读者解答为何前面的章节都未提及 script-setup 组件语法的信息。</p><p>笔者在执笔之初，考虑到降低初学过程中的各种心智负担，以及当时处于 script-setup 组件语法尚未完全稳定的背景下，所以在最后一章 <a href="/efficient.html">高效开发</a> 之前的章节，都只提供了组件的标准写法的讲解。</p><p>除非遇到框架进行了 Breaking Change （例如从 Vue 2 升级到了 Vue 3 这种大版本更新），否则标准写法是始终有效的，在笔者多年的学习经历和实际收获里，也是比较相信一点：不论学习什么语言或者框架，只要基础打的好，未来总是可以轻松地举一反三去解决遇到的各类问题。</p><p>因此如果读者通过各类脚手架创建的 Vue 3 项目，在组件看到 <code>&lt;script setup&gt;</code> 这种风格的组件，以及诸如 <code>defineXxx</code> 风格的 API ，这是 <code>.vue</code> 组件所支持的一种语法糖，可以随时在 <a href="/efficient.html">高效开发</a> 一章了解相关的 API 用法。</p><p>另外从 Vue 3.4 版本之后所新增的 API 未在本书的介绍范围内，请读者在阅读的过程中也可以查阅官方的 API 一起学习，不论是本书还是其他计算机书籍，官方文档永远是最好的查询手册。</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>语法糖（英语：Syntactic sugar）是由英国计算机科学家彼得·兰丁发明的一个术语，指计算机语言中添加的某种语法，这种语法对语言的功能没有影响，但是更方便程序员使用。语法糖让程序更加简洁，有更高的可读性。</p></div></div><h2 id="插件的安装和引入" tabindex="-1">插件的安装和引入 <a class="header-anchor" href="#插件的安装和引入" aria-label="Permalink to &quot;插件的安装和引入&quot;">​</a></h2><p>在 <a href="./guide.html#了解前端工程化">前端工程化</a> 十分普及的今天，可以说几乎所有要用到的插件，都可以在 <a href="https://www.npmjs.com/" target="_blank" rel="noreferrer">npmjs</a> 上搜到，除了官方提供的包管理器 npm ，也有很多种安装方式选择。</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>如果还不了解什么是包和包管理器，请先阅读 <a href="./guide.html#了解包和插件">了解包和插件</a> 一节的内容。</p><p>另外，每个包管理都可以配置镜像源，提升国内的下载速度，对此也可以先阅读 <a href="./guide.html#配置镜像源">配置镜像源</a> 一节了解。</p></div><p>虽然对于个人开发者来说，有一个用的顺手的包管理器就足够日常开发了，但是还是有必要多了解一下不同的包管理器，因为未来可能会面对团队协作开发、为开源项目贡献代码等情况，需要遵循团队要求的包管理机制（例如使用 Monorepo 架构的团队会更青睐于 yarn 或 pnpm 的 Workspace 功能）。</p><h3 id="通过-npm-安装" tabindex="-1">通过 npm 安装 <a class="header-anchor" href="#通过-npm-安装" aria-label="Permalink to &quot;通过 npm 安装&quot;">​</a></h3><p><a href="https://github.com/npm/cli" target="_blank" rel="noreferrer">npm</a> 是 Node.js 自带的包管理器，平时通过 <code>npm install</code> 命令来安装各种 npm 包（比如 <code>npm install vue-router</code> ），就是通过这个包管理器来安装的。</p><p>如果包的下载速度太慢，可以通过以下命令管理镜像源：</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 查看下载源</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">config</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">get</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">registry</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 绑定下载源</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">config</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">set</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">registry</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">https://registry.npmmirror.com</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 删除下载源</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">config</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">rm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">registry</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>npm 的 lock 文件是 <code>package-lock.json</code> ，如果有管理多人协作仓库的需求，可以根据实际情况把它添加至 <code>.gitignore</code> 文件，便于统一团队的包管理。</p></div><h3 id="通过-cnpm-安装" tabindex="-1">通过 cnpm 安装 <a class="header-anchor" href="#通过-cnpm-安装" aria-label="Permalink to &quot;通过 cnpm 安装&quot;">​</a></h3><p><a href="https://github.com/cnpm/cnpm" target="_blank" rel="noreferrer">cnpm</a> 是阿里巴巴推出的包管理工具，安装之后默认会使用 <code>https://registry.npmmirror.com</code> 这个镜像源。</p><p>它的安装命令和 npm 非常一致，通过 <code>cnpm install</code> 命令来安装（比如 <code>cnpm install vue-router</code>）。</p><p>在使用它之前，需要通过 npm 命令进行全局安装：</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">install</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">-g</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">cnpm</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 或者</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># npm install -g cnpm --registry=https://registry.npmmirror.com</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>cnpm 不生成 lock 文件，也不会识别项目下的 lock 文件，所以还是推荐使用 npm 或者其他包管理工具，通过绑定镜像源的方式来管理项目的包。</p></div><h3 id="通过-yarn-安装" tabindex="-1">通过 yarn 安装 <a class="header-anchor" href="#通过-yarn-安装" aria-label="Permalink to &quot;通过 yarn 安装&quot;">​</a></h3><p><a href="https://github.com/yarnpkg/yarn" target="_blank" rel="noreferrer">yarn</a> 也是一个常用的包管理工具，和 npm 十分相似， npmjs 上的包，也会同步到 <a href="https://yarnpkg.com/" target="_blank" rel="noreferrer">yarnpkg</a> 。</p><p>也是需要全局安装才可以使用：</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">install</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">-g</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">yarn</span></span></code></pre></div><p>但是安装命令上会有点不同， yarn 是用 <code>add</code> 代替 <code>install</code> ，用 <code>remove</code> 代替 <code>uninstall</code> ，例如：</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 安装单个包</span></span>
<span class="line"><span style="color:#FFCB6B;">yarn</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">add</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">vue-router</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 安装全局包</span></span>
<span class="line"><span style="color:#FFCB6B;">yarn</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">global</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">add</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">typescript</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 卸载包</span></span>
<span class="line"><span style="color:#FFCB6B;">yarn</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">remove</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">vue-router</span></span></code></pre></div><p>而且在运行脚本的时候，可以直接用 <code>yarn</code> 来代替 <code>npm run</code> ，例如 <code>yarn dev</code> 相当于 <code>npm run dev</code> 。</p><p>yarn 默认绑定的是 <code>https://registry.yarnpkg.com</code> 的下载源，如果包的下载速度太慢，也可以配置镜像源，但是命令有所差异：</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 查看镜像源</span></span>
<span class="line"><span style="color:#FFCB6B;">yarn</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">config</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">get</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">registry</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 绑定镜像源</span></span>
<span class="line"><span style="color:#FFCB6B;">yarn</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">config</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">set</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">registry</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">https://registry.npmmirror.com</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 删除镜像源（注意这里是 delete ）</span></span>
<span class="line"><span style="color:#FFCB6B;">yarn</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">config</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">delete</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">registry</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>yarn 的 lock 文件是 <code>yarn.lock</code> ，如果有管理多人协作仓库的需求，可以根据实际情况把它添加至 <code>.gitignore</code> 文件，便于统一团队的包管理。</p></div><h3 id="通过-pnpm-安装" tabindex="-1">通过 pnpm 安装 <a class="header-anchor" href="#通过-pnpm-安装" aria-label="Permalink to &quot;通过 pnpm 安装&quot;">​</a></h3><p><a href="https://github.com/pnpm/pnpm" target="_blank" rel="noreferrer">pnpm</a> 是包管理工具的一个后起之秀，主打快速的、节省磁盘空间的特色，用法跟其他包管理器很相似，没有太多的学习成本， npm 和 yarn 的命令它都支持。</p><p>也是必须先全局安装它才可以使用：</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">install</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">-g</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">pnpm</span></span></code></pre></div><p>目前 pnpm 在开源社区的使用率越来越高，包括接触最多的 Vue / Vite 团队也在逐步迁移到 pnpm 来管理依赖。</p><p>pnpm 的下载源使用的是 npm ，所以如果要绑定镜像源，按照 <a href="#通过-npm-安装">npm 的方式</a> 处理就可以了。</p><p>相关阅读：</p><ul><li><a href="https://pnpm.io/zh/" target="_blank" rel="noreferrer">pnpm 官网</a></li><li><a href="https://pnpm.io/zh/motivation" target="_blank" rel="noreferrer">为什么要使用 pnpm</a></li><li><a href="https://zhuanlan.zhihu.com/p/441547677" target="_blank" rel="noreferrer">为什么 vue 源码以及生态仓库要迁移 pnpm?</a></li><li><a href="https://zhuanlan.zhihu.com/p/377593512" target="_blank" rel="noreferrer">关于现代包管理器的深度思考 —— 为什么现在我更推荐 pnpm 而不是 npm/yarn?</a></li></ul><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>pnpm 的 lock 文件是 <code>pnpm-lock.yaml</code> ，如果有管理多人协作仓库的需求，可以根据实际情况把它添加至 <code>.gitignore</code> 文件，便于统一团队的包管理。</p></div><h3 id="通过-cdn-安装" tabindex="-1">通过 CDN 安装 <a class="header-anchor" href="#通过-cdn-安装" aria-label="Permalink to &quot;通过 CDN 安装&quot;">​</a></h3><p>大部分插件都会提供一个 CDN 版本，让可以在 <code>.html</code> 文件里通过 <code>&lt;script&gt;</code> 标签引入。</p><p>比如：</p><div class="language-html"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">src</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">https://unpkg.com/vue-router</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;&lt;/</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span></code></pre></div><h3 id="插件的引入" tabindex="-1">插件的引入 <a class="header-anchor" href="#插件的引入" aria-label="Permalink to &quot;插件的引入&quot;">​</a></h3><p>除了 CDN 版本是直接可用之外，其他通过 npm 、 yarn 等方式安装的插件，都需要在入口文件 <code>main.ts</code> 或者要用到的 <code>.vue</code> 文件里引入，比如：</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">createRouter</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">createWebHistory</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vue-router</span><span style="color:#89DDFF;">&#39;</span></span></code></pre></div><p>因为本教程都是基于工程化开发，使用的 CLI 脚手架，所以这些内容暂时不谈及 CDN 的使用方式。</p><p>通常来说会有细微差别，但影响不大，插件作者也会在插件仓库的 README 或者使用文档里进行告知。</p><h2 id="vue-专属插件" tabindex="-1">Vue 专属插件 <a class="header-anchor" href="#vue-专属插件" aria-label="Permalink to &quot;Vue 专属插件&quot;">​</a></h2><p>这里特指 Vue 插件，通过 <a href="https://cn.vuejs.org/guide/reusability/plugins.html" target="_blank" rel="noreferrer">Vue Plugins 设计规范</a> 开发出来的插件，在 npm 上通常是以 <code>vue-xxx</code> 这样带有 vue 关键字的格式命名（比如 <a href="https://github.com/chengpeiquan/vue-baidu-analytics" target="_blank" rel="noreferrer">vue-baidu-analytics</a>）。</p><p>专属插件通常分为 <strong>全局插件</strong> 和 <strong>单组件插件</strong>，区别在于，全局版本是在 <code>main.ts</code> 引入后 <code>use</code>，而单组件版本则通常是作为一个组件在 <code>.vue</code> 文件里引入使用。</p><h3 id="全局插件的使用-new" tabindex="-1">全局插件的使用 ~new <a class="header-anchor" href="#全局插件的使用-new" aria-label="Permalink to &quot;全局插件的使用 ~new&quot;">​</a></h3><p>在本教程最最前面的时候，特地说了一个内容就是 <a href="./upgrade.html#项目初始化">项目初始化</a> ，在这里有提到过就是需要通过 <code>use</code> 来初始化框架、插件。</p><p>全局插件的使用，就是在 <code>main.ts</code> 通过 <code>import</code> 引入，然后通过 <code>use</code> 来启动初始化。</p><p>在 Vue 2 ，全局插件是通过 <code>Vue.use(xxx)</code> 来启动，而现在，则需要通过 <code>createApp</code> 的 <code>use</code>，既可以单独一行一个 use ，也可以直接链式 use 下去。</p><p><strong>参数</strong></p><p><code>use</code> 方法支持两个参数：</p><table><thead><tr><th style="text-align:left;">参数</th><th style="text-align:left;">类型</th><th style="text-align:left;">作用</th></tr></thead><tbody><tr><td style="text-align:left;">plugin</td><td style="text-align:left;">object | function</td><td style="text-align:left;">插件，一般是在 import 时使用的名称</td></tr><tr><td style="text-align:left;">options</td><td style="text-align:left;">object</td><td style="text-align:left;">插件的参数，有些插件在初始化时可以配置一定的选项</td></tr></tbody></table><p>基本的写法就是像下面这样：</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// main.ts</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> plugin1 </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">plugin1</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> plugin2 </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">plugin2</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> plugin3 </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">plugin3</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> plugin4 </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">plugin4</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">createApp</span><span style="color:#BABED8;">(App)</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">use</span><span style="color:#BABED8;">(plugin1)</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">use</span><span style="color:#BABED8;">(plugin2)</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">use</span><span style="color:#BABED8;">(plugin3</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// plugin3&#39;s options</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">use</span><span style="color:#BABED8;">(plugin4)</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">mount</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">#app</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span></code></pre></div><p>大部分插件到这里就可以直接启动了，个别插件可能需要通过插件 API 去手动触发，在 npm 包的详情页或者 GitHub 仓库文档上，作者一般会告知使用方法，按照说明书操作即可。</p><h3 id="单组件插件的使用-new" tabindex="-1">单组件插件的使用 ~new <a class="header-anchor" href="#单组件插件的使用-new" aria-label="Permalink to &quot;单组件插件的使用 ~new&quot;">​</a></h3><p>单组件的插件，通常自己本身也是一个 Vue 组件（大部分情况下都会打包为 JS 文件，但本质上是一个 Vue 的 Component ）。</p><p>单组件的引入，一般都是在需要用到的 <code>.vue</code> 文件里单独 <code>import</code> ，然后挂到 <code>&lt;template /&gt;</code> 里去渲染，下面是一段模拟代码，理解起来会比较直观：</p><div class="language-vue"><button title="Copy Code" class="copy"></button><span class="lang">vue</span><pre class="shiki material-theme-palenight has-highlighted-lines"><code><span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">template</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line highlighted"><span style="color:#BABED8;">  </span><span style="color:#676E95;font-style:italic;">&lt;!-- 放置组件的渲染标签，用于显示组件 --&gt;</span></span>
<span class="line highlighted"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">ComponentExample</span><span style="color:#89DDFF;"> /&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">template</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">script</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">lang</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">ts</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">defineComponent</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">onMounted</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">ref</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vue</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> logo </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@/assets/logo.png</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line highlighted"><span style="color:#676E95;font-style:italic;">// 引入单组件插件</span></span>
<span class="line highlighted"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> ComponentExample </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">a-component-example</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">default</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">defineComponent</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line highlighted"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// 挂载组件模板</span></span>
<span class="line highlighted"><span style="color:#BABED8;">  </span><span style="color:#F07178;">components</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line highlighted"><span style="color:#BABED8;">    ComponentExample</span><span style="color:#89DDFF;">,</span></span>
<span class="line highlighted"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span></code></pre></div><p>参考上面的代码还有注释，应该能大概了解如何使用单组件插件了吧！</p><h2 id="通用-js-ts-插件" tabindex="-1">通用 JS / TS 插件 <a class="header-anchor" href="#通用-js-ts-插件" aria-label="Permalink to &quot;通用 JS / TS 插件&quot;">​</a></h2><p>也叫普通插件，这个 “普通” 不是指功能平平无奇，而是指它们无需任何框架依赖，可以应用在任意项目中，属于独立的 Library ，比如 <a href="https://github.com/axios/axios" target="_blank" rel="noreferrer">axios</a> 、 <a href="https://github.com/soldair/node-qrcode" target="_blank" rel="noreferrer">qrcode</a> 、<a href="https://github.com/pvorb/node-md5" target="_blank" rel="noreferrer">md5</a> 等等，在任何技术栈都可以单独引入使用，非 Vue 专属。</p><p>通用插件的使用非常灵活，既可以全局挂载，也可以在需要用到的组件里单独引入。</p><p>组件里单独引入方式：</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">defineComponent</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vue</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> md5 </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@withtypes/md5</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">default</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">defineComponent</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">setup</span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">md5Msg</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">md5</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">message</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span></span></code></pre></div><p>全局挂载方法比较特殊，因为插件本身不是专属 Vue，没有 <code>install</code> 接口，无法通过 <code>use</code> 方法直接启动，下面有一小节内容单独讲这一块的操作，详见 <a href="#全局-api-挂载">全局 API 挂载</a>。</p><h2 id="本地插件-new" tabindex="-1">本地插件 ~new <a class="header-anchor" href="#本地插件-new" aria-label="Permalink to &quot;本地插件 ~new&quot;">​</a></h2><p>插件也不全是来自于网上，有时候针对自己的业务，涉及到一些经常用到的功能模块，也可以抽离出来封装成项目专用的插件。</p><h3 id="封装的目的" tabindex="-1">封装的目的 <a class="header-anchor" href="#封装的目的" aria-label="Permalink to &quot;封装的目的&quot;">​</a></h3><p>举个例子，比如在做一个具备用户系统的网站时，会涉及到手机短信验证码模块，在开始写代码之前，需要先要考虑到这些问题：</p><ol><li><p>很多操作都涉及到下发验证码的请求，比如 “登录” 、 “注册” 、 “修改手机绑定” 、 “支付验证” 等等，代码雷同，只是接口 URL 或者参数不太一样</p></li><li><p>都是需要对手机号是否有传入、手机号的格式正确性验证等一些判断</p></li><li><p>需要对接口请求成功和失败的情况做一些不同的数据返回，但要处理的数据很相似，都是用于告知调用方当前是什么情况</p></li><li><p>返回一些 Toast 告知用户当前的交互结果</p></li></ol><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>如果不把这一块的业务代码抽离出来，需要在每个用到的地方都写一次，不仅繁琐，而且以后一旦产品需求有改动，维护起来就惨了。</p></div><h3 id="常用的封装类型" tabindex="-1">常用的封装类型 <a class="header-anchor" href="#常用的封装类型" aria-label="Permalink to &quot;常用的封装类型&quot;">​</a></h3><p>常用的本地封装方式有两种：一种是以 <a href="#通用-js-ts-插件">通用 JS / TS 插件</a> 的形式，一种是以 <a href="#vue-专属插件">Vue 专属插件</a> 的形式。</p><p>关于这两者的区别已经在对应的小节有所介绍，接下来来看看如何封装它们。</p><h3 id="开发本地通用-js-ts-插件" tabindex="-1">开发本地通用 JS / TS 插件 <a class="header-anchor" href="#开发本地通用-js-ts-插件" aria-label="Permalink to &quot;开发本地通用 JS / TS 插件&quot;">​</a></h3><p>一般情况下会以通用类型比较常见，因为大部分都是一些比较小的功能，而且可以很方便的在不同项目之间进行复用。</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>注：接下来会统一称之为 “通用插件” ，不论是基于 JavaScript 编写的还是 TypeScript 编写的。</p></div><h4 id="项目结构" tabindex="-1">项目结构 <a class="header-anchor" href="#项目结构" aria-label="Permalink to &quot;项目结构&quot;">​</a></h4><p>通常会把这一类文件都归类在 <code>src</code> 目录下的 <code>libs</code> 文件夹里，代表存放的是 Library 文件（ JS 项目以 <code>.js</code> 文件存放， TS 项目以 <code>.ts</code> 文件存放）。</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight has-highlighted-lines"><code><span class="line"><span style="color:#FFCB6B;">vue-demo</span></span>
<span class="line"><span style="color:#FFCB6B;">│</span><span style="color:#BABED8;"> </span><span style="color:#676E95;font-style:italic;"># 源码文件夹</span></span>
<span class="line"><span style="color:#FFCB6B;">├─src</span></span>
<span class="line highlighted"><span style="color:#FFCB6B;">│</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">│</span><span style="color:#BABED8;"> </span><span style="color:#676E95;font-style:italic;"># 本地通用插件</span></span>
<span class="line highlighted"><span style="color:#FFCB6B;">│</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">└─libs</span></span>
<span class="line highlighted"><span style="color:#FFCB6B;">│</span><span style="color:#BABED8;">   </span><span style="color:#C3E88D;">├─foo.ts</span></span>
<span class="line highlighted"><span style="color:#FFCB6B;">│</span><span style="color:#BABED8;">   </span><span style="color:#C3E88D;">└─bar.ts</span></span>
<span class="line"><span style="color:#FFCB6B;">│</span></span>
<span class="line"><span style="color:#FFCB6B;">│</span><span style="color:#BABED8;"> </span><span style="color:#676E95;font-style:italic;"># 其他结构这里省略…</span></span>
<span class="line"><span style="color:#FFCB6B;">│</span></span>
<span class="line"><span style="color:#FFCB6B;">└─package.json</span></span></code></pre></div><p>这样在调用的时候，可以通过 <code>@/libs/foo</code> 来引入，或者配置了 alias 别名，也可以使用别名导入，例如 <code>@libs/foo</code> 。</p><h4 id="设计规范与开发案例" tabindex="-1">设计规范与开发案例 <a class="header-anchor" href="#设计规范与开发案例" aria-label="Permalink to &quot;设计规范与开发案例&quot;">​</a></h4><p>在设计本地通用插件的时候，需要遵循 <a href="#用-es-module-设计模块">ES Module 模块设计规范</a> ，并且做好必要的代码注释（用途、入参、返回值等）。</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>如果还没有了解过 “模块” 的概念的话，可以先阅读 <a href="./guide.html#了解模块化设计">了解模块化设计</a> 一节的内容。</p></div><p>一般来说，会有以下三种情况需要考虑。</p><h5 id="只有一个默认功能" tabindex="-1">只有一个默认功能 <a class="header-anchor" href="#只有一个默认功能" aria-label="Permalink to &quot;只有一个默认功能&quot;">​</a></h5><p>如果只有一个默认的功能，那么可以使用 <code>export default</code> 来默认导出一个函数。</p><p>例如需要封装一个打招呼的功能：</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// src/libs/greet.ts</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * 向对方打招呼</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * </span><span style="color:#89DDFF;font-style:italic;">@</span><span style="color:#C792EA;font-style:italic;">param</span><span style="color:#676E95;font-style:italic;"> </span><span style="color:#BABED8;font-style:italic;">name</span><span style="color:#676E95;font-style:italic;"> - 打招呼的目标人名</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * </span><span style="color:#89DDFF;font-style:italic;">@</span><span style="color:#C792EA;font-style:italic;">returns</span><span style="color:#676E95;font-style:italic;"> 向传进来的人名返回一句欢迎语</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">default</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">function</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">greet</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">name</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">):</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">`</span><span style="color:#C3E88D;">Welcome, </span><span style="color:#89DDFF;">${</span><span style="color:#BABED8;">name</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">!</span><span style="color:#89DDFF;">`</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>在 Vue 组件里就可以这样使用：</p><div class="language-vue"><button title="Copy Code" class="copy"></button><span class="lang">vue</span><pre class="shiki material-theme-palenight has-highlighted-lines"><code><span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">script</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">lang</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">ts</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">defineComponent</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vue</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line highlighted"><span style="color:#676E95;font-style:italic;">// 导入本地插件</span></span>
<span class="line highlighted"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> greet </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@libs/greet</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">default</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">defineComponent</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">setup</span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line highlighted"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// 导入的名称就是这个工具的方法名，可以直接调用</span></span>
<span class="line highlighted"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">message</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">greet</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Petter</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line highlighted"><span style="color:#F07178;">    </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">message</span><span style="color:#F07178;">) </span><span style="color:#676E95;font-style:italic;">// Welcome, Petter!</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span></code></pre></div><h5 id="是一个小工具合集" tabindex="-1">是一个小工具合集 <a class="header-anchor" href="#是一个小工具合集" aria-label="Permalink to &quot;是一个小工具合集&quot;">​</a></h5><p>如果有很多个作用相似的函数，那么建议放在一个文件里作为一个工具合集统一管理，使用 <code>export</code> 来导出里面的每个函数。</p><p>例如需要封装几个通过 <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Regular_Expressions" target="_blank" rel="noreferrer">正则表达式</a> 判断表单的输入内容是否符合要求的函数：</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// src/libs/regexp.ts</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * 手机号校验</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * </span><span style="color:#89DDFF;font-style:italic;">@</span><span style="color:#C792EA;font-style:italic;">param</span><span style="color:#676E95;font-style:italic;"> </span><span style="color:#BABED8;font-style:italic;">phoneNumber</span><span style="color:#676E95;font-style:italic;"> - 手机号</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * </span><span style="color:#89DDFF;font-style:italic;">@</span><span style="color:#C792EA;font-style:italic;">returns</span><span style="color:#676E95;font-style:italic;"> true=是手机号，false=不是手机号</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">function</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">isMob</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">phoneNumber</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">number</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">|</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">):</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">boolean</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">/</span><span style="color:#89DDFF;font-style:italic;">^</span><span style="color:#C3E88D;">1</span><span style="color:#89DDFF;">[</span><span style="color:#C3E88D;">3456789</span><span style="color:#89DDFF;">]</span><span style="color:#C3E88D;">\d</span><span style="color:#89DDFF;">{9}</span><span style="color:#89DDFF;font-style:italic;">$</span><span style="color:#89DDFF;">/</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">test</span><span style="color:#F07178;">(</span><span style="color:#82AAFF;">String</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">phoneNumber</span><span style="color:#F07178;">))</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * 邮箱校验</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * </span><span style="color:#89DDFF;font-style:italic;">@</span><span style="color:#C792EA;font-style:italic;">param</span><span style="color:#676E95;font-style:italic;"> </span><span style="color:#BABED8;font-style:italic;">email</span><span style="color:#676E95;font-style:italic;"> - 邮箱地址</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * </span><span style="color:#89DDFF;font-style:italic;">@</span><span style="color:#C792EA;font-style:italic;">returns</span><span style="color:#676E95;font-style:italic;"> true=是邮箱地址，false=不是邮箱地址</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">function</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">isEmail</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">email</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">):</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">boolean</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">/</span><span style="color:#89DDFF;font-style:italic;">^</span><span style="color:#89DDFF;">[</span><span style="color:#C3E88D;">A-Za-z\d</span><span style="color:#89DDFF;">]+([</span><span style="color:#C3E88D;">-_.</span><span style="color:#89DDFF;">][</span><span style="color:#C3E88D;">A-Za-z\d</span><span style="color:#89DDFF;">]+)*</span><span style="color:#C3E88D;">@</span><span style="color:#89DDFF;">([</span><span style="color:#C3E88D;">A-Za-z\d</span><span style="color:#89DDFF;">]+[</span><span style="color:#C3E88D;">-.</span><span style="color:#89DDFF;">])+[</span><span style="color:#C3E88D;">A-Za-z\d</span><span style="color:#89DDFF;">]{2,4}</span><span style="color:#89DDFF;font-style:italic;">$</span><span style="color:#89DDFF;">/</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">test</span><span style="color:#F07178;">(</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#BABED8;">email</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">  )</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>在 Vue 组件里就可以这样使用：</p><div class="language-vue"><button title="Copy Code" class="copy"></button><span class="lang">vue</span><pre class="shiki material-theme-palenight has-highlighted-lines"><code><span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">script</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">lang</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">ts</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">defineComponent</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vue</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line highlighted"><span style="color:#676E95;font-style:italic;">// 需要用花括号 {} 来按照命名导出时的名称导入</span></span>
<span class="line highlighted"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">isMob</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">isEmail</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@libs/regexp</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">default</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">defineComponent</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">setup</span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line highlighted"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// 判断是否是手机号</span></span>
<span class="line highlighted"><span style="color:#F07178;">    </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#82AAFF;">isMob</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">13800138000</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)) </span><span style="color:#676E95;font-style:italic;">// true</span></span>
<span class="line highlighted"><span style="color:#F07178;">    </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#82AAFF;">isMob</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">123456</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)) </span><span style="color:#676E95;font-style:italic;">// false</span></span>
<span class="line highlighted"><wbr></span>
<span class="line highlighted"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// 判断是否是邮箱地址</span></span>
<span class="line highlighted"><span style="color:#F07178;">    </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#82AAFF;">isEmail</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">example@example.com</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)) </span><span style="color:#676E95;font-style:italic;">// true</span></span>
<span class="line highlighted"><span style="color:#F07178;">    </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#82AAFF;">isEmail</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">example</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)) </span><span style="color:#676E95;font-style:italic;">// false</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>类似这种情况，就没有必要为 <code>isMob</code> 、 <code>isEmail</code> 每个方法都单独保存一个文件了，只需要统一放在 <code>regexp.ts</code> 正则文件里维护。</p></div><h5 id="包含工具及辅助函数" tabindex="-1">包含工具及辅助函数 <a class="header-anchor" href="#包含工具及辅助函数" aria-label="Permalink to &quot;包含工具及辅助函数&quot;">​</a></h5><p>如果主要提供一个独立功能，但还需要提供一些额外的变量或者辅助函数用于特殊的业务场景，那么可以用 <code>export default</code> 导出主功能，用 <code>export</code> 导出其他变量或者辅助函数。</p><p>在 <a href="#只有一个默认功能">只有一个默认功能</a> 这个打招呼例子的基础上修改一下，默认提供的是 “打招呼” 的功能，偶尔需要更热情的赞美一下，那么这个 “赞美” 行为就可以用这个方式来放到这个文件里一起维护。</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight has-highlighted-lines"><code><span class="line"><span style="color:#676E95;font-style:italic;">// src/libs/greet.ts</span></span>
<span class="line"></span>
<span class="line highlighted"><span style="color:#676E95;font-style:italic;">/**</span></span>
<span class="line highlighted"><span style="color:#676E95;font-style:italic;"> * 称赞对方</span></span>
<span class="line highlighted"><span style="color:#676E95;font-style:italic;"> * </span><span style="color:#89DDFF;font-style:italic;">@</span><span style="color:#C792EA;font-style:italic;">param</span><span style="color:#676E95;font-style:italic;"> </span><span style="color:#BABED8;font-style:italic;">name</span><span style="color:#676E95;font-style:italic;"> - 要称赞的目标人名</span></span>
<span class="line highlighted"><span style="color:#676E95;font-style:italic;"> * </span><span style="color:#89DDFF;font-style:italic;">@</span><span style="color:#C792EA;font-style:italic;">returns</span><span style="color:#676E95;font-style:italic;"> 向传进来的人名发出一句赞美的话</span></span>
<span class="line highlighted"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line highlighted"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">function</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">praise</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">name</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">):</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line highlighted"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">`</span><span style="color:#C3E88D;">Oh! </span><span style="color:#89DDFF;">${</span><span style="color:#BABED8;">name</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">! It&#39;s so kind of you!</span><span style="color:#89DDFF;">`</span></span>
<span class="line highlighted"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * 向对方打招呼</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * </span><span style="color:#89DDFF;font-style:italic;">@</span><span style="color:#C792EA;font-style:italic;">param</span><span style="color:#676E95;font-style:italic;"> </span><span style="color:#BABED8;font-style:italic;">name</span><span style="color:#676E95;font-style:italic;"> - 打招呼的目标人名</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * </span><span style="color:#89DDFF;font-style:italic;">@</span><span style="color:#C792EA;font-style:italic;">returns</span><span style="color:#676E95;font-style:italic;"> 向传进来的人名发出一句欢迎语</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">default</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">function</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">greet</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">name</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">):</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">`</span><span style="color:#C3E88D;">Welcome, </span><span style="color:#89DDFF;">${</span><span style="color:#BABED8;">name</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">!</span><span style="color:#89DDFF;">`</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>在 Vue 组件里就可以这样使用：</p><div class="language-vue"><button title="Copy Code" class="copy"></button><span class="lang">vue</span><pre class="shiki material-theme-palenight has-highlighted-lines"><code><span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">script</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">lang</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">ts</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">defineComponent</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vue</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line highlighted"><span style="color:#676E95;font-style:italic;">// 两者可以同时导入使用</span></span>
<span class="line highlighted"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> greet</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">praise</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@libs/greet</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">default</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">defineComponent</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">setup</span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// 使用默认的打招呼</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">message</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">greet</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Petter</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">message</span><span style="color:#F07178;">) </span><span style="color:#676E95;font-style:italic;">// Welcome, Petter!</span></span>
<span class="line"></span>
<span class="line highlighted"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// 使用命名导出的赞美</span></span>
<span class="line highlighted"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">praiseMessage</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">praise</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Petter</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line highlighted"><span style="color:#F07178;">    </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">praiseMessage</span><span style="color:#F07178;">) </span><span style="color:#676E95;font-style:italic;">// Oh! Petter! It&#39;s so kind of you!</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span></code></pre></div><h3 id="开发本地-vue-专属插件" tabindex="-1">开发本地 Vue 专属插件 <a class="header-anchor" href="#开发本地-vue-专属插件" aria-label="Permalink to &quot;开发本地 Vue 专属插件&quot;">​</a></h3><p>在 <a href="#vue-专属插件">Vue 专属插件</a> 部分已介绍过，这一类的插件只能给 Vue 使用，有时候自己的业务比较特殊，无法找到完全适用的 npm 包，那么就可以自己写一个！</p><h4 id="项目结构-1" tabindex="-1">项目结构 <a class="header-anchor" href="#项目结构-1" aria-label="Permalink to &quot;项目结构&quot;">​</a></h4><p>通常会把这一类文件都归类在 <code>src</code> 目录下的 <code>plugins</code> 文件夹里，代表存放的是 Plugin 文件（ JS 项目以 <code>.js</code> 文件存放， TS 项目以 <code>.ts</code> 文件存放）。</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight has-highlighted-lines"><code><span class="line"><span style="color:#FFCB6B;">vue-demo</span></span>
<span class="line"><span style="color:#FFCB6B;">│</span><span style="color:#BABED8;"> </span><span style="color:#676E95;font-style:italic;"># 源码文件夹</span></span>
<span class="line"><span style="color:#FFCB6B;">├─src</span></span>
<span class="line highlighted"><span style="color:#FFCB6B;">│</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">│</span><span style="color:#BABED8;"> </span><span style="color:#676E95;font-style:italic;"># 本地 Vue 插件</span></span>
<span class="line highlighted"><span style="color:#FFCB6B;">│</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">└─plugins</span></span>
<span class="line highlighted"><span style="color:#FFCB6B;">│</span><span style="color:#BABED8;">   </span><span style="color:#C3E88D;">├─foo.ts</span></span>
<span class="line highlighted"><span style="color:#FFCB6B;">│</span><span style="color:#BABED8;">   </span><span style="color:#C3E88D;">└─bar.ts</span></span>
<span class="line"><span style="color:#FFCB6B;">│</span></span>
<span class="line"><span style="color:#FFCB6B;">│</span><span style="color:#BABED8;"> </span><span style="color:#676E95;font-style:italic;"># 其他结构这里省略…</span></span>
<span class="line"><span style="color:#FFCB6B;">│</span></span>
<span class="line"><span style="color:#FFCB6B;">└─package.json</span></span></code></pre></div><p>这样在调用的时候，可以通过 <code>@/plugins/foo</code> 来引入，或者配置了 alias 别名，也可以使用别名导入，例如 <code>@plugins/foo</code> 。</p><h4 id="设计规范" tabindex="-1">设计规范 <a class="header-anchor" href="#设计规范" aria-label="Permalink to &quot;设计规范&quot;">​</a></h4><p>在设计本地 Vue 插件的时候，需要遵循 Vue 官方撰写的 <a href="https://cn.vuejs.org/guide/reusability/plugins.html" target="_blank" rel="noreferrer">Vue Plugins 设计规范</a> ，并且做好必要的代码注释，除了标明插件 API 的 “用途、入参、返回值” 之外，最好在注释内补充一个 Example 或者 Tips 说明，功能丰富的插件最好直接写个 README 文档。</p><h4 id="开发案例" tabindex="-1">开发案例 <a class="header-anchor" href="#开发案例" aria-label="Permalink to &quot;开发案例&quot;">​</a></h4><p>全局插件开发并启用后，只需要在 <code>main.ts</code> 里导入并 <code>use</code> 一次，即可在所有的组件内使用插件的功能。</p><p>下面对全局插件进行一个开发示范，希望能给大家以后需要的时候提供思路参考。</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>单组件插件一般作为 npm 包发布，会借助 Webpack 、 Vite 或者 Rollup 单独构建，本地直接放到 components 文件夹下作为组件管理即可。</p></div><h5 id="基本结构" tabindex="-1">基本结构 <a class="header-anchor" href="#基本结构" aria-label="Permalink to &quot;基本结构&quot;">​</a></h5><p>插件支持导出两种格式的：一种是函数，一种是对象。</p><ol><li>当导出为一个函数时， Vue 会直接调用这个函数，此时插件内部是这样子：</li></ol><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">default</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">function</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">app</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">options</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// 逻辑代码...</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><ol start="2"><li>当导出为一个对象时，对象上面需要有一个 <code>install</code> 方法给 Vue ， Vue 通过调用这个方法来启用插件，此时插件内部是这样子：</li></ol><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">default</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#82AAFF;">install</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">app</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">options</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// 逻辑代码...</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>不论哪种方式，入口函数都会接受两个入参：</p><table><thead><tr><th style="text-align:center;">参数</th><th style="text-align:center;">作用</th><th style="text-align:left;">类型</th></tr></thead><tbody><tr><td style="text-align:center;">app</td><td style="text-align:center;"><code>createApp</code> 生成的实例</td><td style="text-align:left;"><code>App</code> （从 &#39;vue&#39; 里导入该类型），见下方的案例演示</td></tr><tr><td style="text-align:center;">options</td><td style="text-align:center;">插件初始化时的选项</td><td style="text-align:left;"><code>undefined</code> 或一个对象，对象的 TS 类型由插件的选项决定</td></tr></tbody></table><p>如果需要在插件初始化时传入一些必要的选项，可以定义一个对象作为 options ，这样只要在 <code>main.ts</code> 里 <code>use</code> 插件时传入第二个参数，插件就可以拿到它们：</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight has-highlighted-lines"><code><span class="line"><span style="color:#676E95;font-style:italic;">// src/main.ts</span></span>
<span class="line"><span style="color:#82AAFF;">createApp</span><span style="color:#BABED8;">(App)</span></span>
<span class="line highlighted"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// 注意这里的第二个参数就是插件选项</span></span>
<span class="line highlighted"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">use</span><span style="color:#BABED8;">(customPlugin</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line highlighted"><span style="color:#BABED8;">    </span><span style="color:#F07178;">foo</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span></span>
<span class="line highlighted"><span style="color:#BABED8;">    </span><span style="color:#F07178;">bar</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">,</span></span>
<span class="line highlighted"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">mount</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">#app</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span></code></pre></div><h5 id="编写插件" tabindex="-1">编写插件 <a class="header-anchor" href="#编写插件" aria-label="Permalink to &quot;编写插件&quot;">​</a></h5><p>这里以一个 <a href="./component.html#自定义指令">自定义指令</a> 为例，写一个用于管理自定义指令的插件，其中包含两个自定义指令：一个是判断是否有权限，一个是给文本高亮，文本高亮还支持一个插件选项。</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight has-highlighted-lines"><code><span class="line"><span style="color:#676E95;font-style:italic;">// src/plugins/directive.ts</span></span>
<span class="line highlighted"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">type</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">App</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vue</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line highlighted"><span style="color:#676E95;font-style:italic;">// 插件选项的类型</span></span>
<span class="line highlighted"><span style="color:#C792EA;">interface</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">Options</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line highlighted"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// 文本高亮选项</span></span>
<span class="line highlighted"><span style="color:#BABED8;">  </span><span style="color:#F07178;">highlight</span><span style="color:#89DDFF;">?:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line highlighted"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// 默认背景色</span></span>
<span class="line highlighted"><span style="color:#BABED8;">    </span><span style="color:#F07178;">backgroundColor</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span></span>
<span class="line highlighted"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line highlighted"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * 自定义指令</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * </span><span style="color:#89DDFF;font-style:italic;">@</span><span style="color:#C792EA;font-style:italic;">description</span><span style="color:#676E95;font-style:italic;"> 保证插件单一职责，当前插件只用于添加自定义指令</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">default</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line highlighted"><span style="color:#BABED8;">  </span><span style="color:#82AAFF;">install</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">app</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">App</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">options</span><span style="color:#89DDFF;">?:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">Options</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#676E95;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">     * 权限控制</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">     * </span><span style="color:#89DDFF;font-style:italic;">@</span><span style="color:#C792EA;font-style:italic;">description</span><span style="color:#676E95;font-style:italic;"> 用于在功能按钮上绑定权限，没权限时会销毁或隐藏对应 DOM 节点</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">     * </span><span style="color:#89DDFF;font-style:italic;">@</span><span style="color:#C792EA;font-style:italic;">tips</span><span style="color:#676E95;font-style:italic;"> 指令传入的值是管理员的组别 id</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">     * </span><span style="color:#89DDFF;font-style:italic;">@</span><span style="color:#C792EA;font-style:italic;">example</span><span style="color:#676E95;font-style:italic;"> &lt;div v-permission=&quot;1&quot; /&gt;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">     */</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#BABED8;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">directive</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">permission</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">el</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;font-style:italic;">binding</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// 假设 1 是管理员组别的 id ，则无需处理</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#BABED8;">binding</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">value</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">1</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;font-style:italic;">return</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// 其他情况认为没有权限，需要隐藏掉界面上的 DOM 元素</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#BABED8;">el</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">parentNode</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#BABED8;">el</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">parentNode</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">removeChild</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">el</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#BABED8;">el</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">style</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">display</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">none</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#676E95;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">     * 文本高亮</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">     * </span><span style="color:#89DDFF;font-style:italic;">@</span><span style="color:#C792EA;font-style:italic;">description</span><span style="color:#676E95;font-style:italic;"> 用于给指定的 DOM 节点添加背景色，搭配文本内容形成高亮效果</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">     * </span><span style="color:#89DDFF;font-style:italic;">@</span><span style="color:#C792EA;font-style:italic;">tips</span><span style="color:#676E95;font-style:italic;"> 指令传入的值需要是合法的 CSS 颜色名称或者 Hex 值</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">     * </span><span style="color:#89DDFF;font-style:italic;">@</span><span style="color:#C792EA;font-style:italic;">example</span><span style="color:#676E95;font-style:italic;"> &lt;div v-highlight=&quot;`cyan`&quot; /&gt;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">     */</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#BABED8;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">directive</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">highlight</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">el</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;font-style:italic;">binding</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// 获取默认颜色</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">defaultColor</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">unset</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#FFCB6B;">Object</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">prototype</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">toString</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">call</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">options</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">[object Object]</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&amp;&amp;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#BABED8;">options</span><span style="color:#89DDFF;">?.</span><span style="color:#BABED8;">highlight</span><span style="color:#89DDFF;">?.</span><span style="color:#BABED8;">backgroundColor</span></span>
<span class="line"><span style="color:#F07178;">      ) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#BABED8;">defaultColor</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">options</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">highlight</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">backgroundColor</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// 设置背景色</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#BABED8;">el</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">style</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">backgroundColor</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">typeof</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">binding</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">value</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">string</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">?</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">binding</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">value</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">defaultColor</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><h5 id="启用插件" tabindex="-1">启用插件 <a class="header-anchor" href="#启用插件" aria-label="Permalink to &quot;启用插件&quot;">​</a></h5><p>在 <code>main.ts</code> 全局启用插件，在启用的时候传入了第二个参数 “插件的选项” ，这里配置了个高亮指令的默认背景颜色：</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight has-highlighted-lines"><code><span class="line"><span style="color:#676E95;font-style:italic;">// src/main.ts</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">createApp</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vue</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> App </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@/App.vue</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line highlighted"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> directive </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@/plugins/directive</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;"> </span><span style="color:#676E95;font-style:italic;">// 导入插件</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">createApp</span><span style="color:#BABED8;">(App)</span></span>
<span class="line highlighted"><span style="color:#89DDFF;">   </span><span style="color:#676E95;font-style:italic;">// 自定义插件</span></span>
<span class="line highlighted"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">use</span><span style="color:#BABED8;">(directive</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line highlighted"><span style="color:#BABED8;">    </span><span style="color:#F07178;">highlight</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line highlighted"><span style="color:#BABED8;">      </span><span style="color:#F07178;">backgroundColor</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">#ddd</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line highlighted"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">},</span></span>
<span class="line highlighted"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">mount</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">#app</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span></code></pre></div><h5 id="使用插件" tabindex="-1">使用插件 <a class="header-anchor" href="#使用插件" aria-label="Permalink to &quot;使用插件&quot;">​</a></h5><p>在 Vue 组件里使用：</p><div class="language-vue"><button title="Copy Code" class="copy"></button><span class="lang">vue</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">template</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#676E95;font-style:italic;">&lt;!-- 测试 permission 指令 --&gt;</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">div</span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;">根据 permission 指令的判断规则：</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">div</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">div</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">v-permission</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">1</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;">这个可以显示</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">div</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">div</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">v-permission</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">2</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;">这个没有权限，会被隐藏</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">div</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#676E95;font-style:italic;">&lt;!-- 测试 highlight 指令 --&gt;</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">div</span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;">根据 highlight 指令的判断规则：</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">div</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">div</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">v-highlight</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">`cyan`</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;">这个是青色高亮</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">div</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">div</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">v-highlight</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">`yellow`</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;">这个是黄色高亮</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">div</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">div</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">v-highlight</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">`red`</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;">这个是红色高亮</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">div</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">div</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">v-highlight</span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;">这个是使用插件初始化时设置的灰色</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">div</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">template</span><span style="color:#89DDFF;">&gt;</span></span></code></pre></div><h2 id="全局-api-挂载" tabindex="-1">全局 API 挂载 <a class="header-anchor" href="#全局-api-挂载" aria-label="Permalink to &quot;全局 API 挂载&quot;">​</a></h2><p>对于一些使用频率比较高的插件方法，如果觉得在每个组件里单独导入再用很麻烦，也可以考虑将其挂载到 Vue 上，使其成为 Vue 的全局变量。</p><p><strong>注：接下来的全局变量，都是指 Vue 环境里的全局变量，非 Window 下的全局变量。</strong></p><h3 id="回顾-vue-2" tabindex="-1">回顾 Vue 2 <a class="header-anchor" href="#回顾-vue-2" aria-label="Permalink to &quot;回顾 Vue 2&quot;">​</a></h3><p>在 Vue 2 ，可以通过 <code>prototype</code> 的方式来挂载全局变量，然后通过 <code>this</code> 关键字来从 Vue 原型上调用该方法。</p><p>以 <code>md5</code> 插件为例，在 <code>main.ts</code> 里进行全局 <code>import</code>，然后通过 <code>prototype</code> 去挂到 Vue 上。</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> Vue </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vue</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> md5 </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">md5</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">Vue</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">prototype</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">$md5 </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> md5</span></span></code></pre></div><p>之后在 <code>.vue</code> 文件里，就可以这样去使用 <code>md5</code>。</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> md5Msg </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#82AAFF;">$md5</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">message</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span></code></pre></div><h3 id="了解-vue-3-new" tabindex="-1">了解 Vue 3 ~new <a class="header-anchor" href="#了解-vue-3-new" aria-label="Permalink to &quot;了解 Vue 3 ~new&quot;">​</a></h3><p>在 Vue 3 ，已经不再支持 <code>prototype</code> 这样使用了，在 <code>main.ts</code> 里没有了 <code>Vue</code>，在组件的生命周期里也没有了 <code>this</code>。</p><p>如果依然想要挂载全局变量，需要通过全新的 <a href="https://cn.vuejs.org/api/application.html#app-config-globalproperties" target="_blank" rel="noreferrer">globalProperties</a> 来实现，在使用该方式之前，可以把 <code>createApp</code> 定义为一个变量再执行挂载。</p><h3 id="定义全局-api-new" tabindex="-1">定义全局 API ~new <a class="header-anchor" href="#定义全局-api-new" aria-label="Permalink to &quot;定义全局 API ~new&quot;">​</a></h3><p>如上，在配置全局变量之前，可以把初始化时的 <code>createApp</code> 定义为一个变量（假设为 <code>app</code> ），然后把需要设置为全局可用的变量或方法，挂载到 <code>app</code> 的 <code>config.globalProperties</code> 上面。</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> md5 </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">md5</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 创建 Vue 实例</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> app </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">createApp</span><span style="color:#BABED8;">(App)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 把插件的 API 挂载全局变量到实例上</span></span>
<span class="line"><span style="color:#BABED8;">app</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">config</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">globalProperties</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">$md5 </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> md5</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 也可以自己写一些全局函数去挂载</span></span>
<span class="line"><span style="color:#BABED8;">app</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">config</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">globalProperties</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">$log</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">text</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">):</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">void</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">text</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">app</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">mount</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">#app</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">)</span></span></code></pre></div><h3 id="全局-api-的替代方案" tabindex="-1">全局 API 的替代方案 <a class="header-anchor" href="#全局-api-的替代方案" aria-label="Permalink to &quot;全局 API 的替代方案&quot;">​</a></h3><p>在 Vue 3 实际上并不是特别推荐使用全局变量，Vue 3 比较推荐按需引入使用，这也是在构建过程中可以更好的做到代码优化。</p><p>特别是针对 TypeScript ， Vue 作者尤雨溪先生对于全局 API 的相关 PR 说明： <a href="https://github.com/vuejs/rfcs/pull/117" target="_blank" rel="noreferrer">Global API updates</a> ，也是不建议在 TS 里使用。</p><p>那么确实是需要用到一些全局 API 怎么办？</p><p>对于一般的数据和方法，建议采用 <a href="./communication.html#provide-inject">Provide / Inject</a> 方案，在根组件（通常是 App.vue ）把需要作为全局使用的数据或方法 Provide 下去，在需要用到的组件里通过 Inject 即可获取到，或者使用 <a href="./communication.html#eventbus-new">EventBus</a> / <a href="./communication.html#vuex-new">Vuex</a> / <a href="./pinia.html">Pinia</a> 等全局通信方案来处理。</p><h2 id="npm-包的开发与发布" tabindex="-1">npm 包的开发与发布 <a class="header-anchor" href="#npm-包的开发与发布" aria-label="Permalink to &quot;npm 包的开发与发布&quot;">​</a></h2><p>相信很多开发者都想发布一个属于自己的 npm 包，在实际的工作中，也会有一些公司出于开发上的便利，也会将一些常用的业务功能抽离为独立的 npm 包，提前掌握包的开发也是非常重要的能力，接下来将介绍如何从 0 到 1 开发一个 npm 包，并将其发布到 <a href="https://www.npmjs.com" target="_blank" rel="noreferrer">npmjs</a> 上可供其他项目安装使用。</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>在开始本节内容之前，请先阅读或回顾以下两部分内容：</p><ol><li>阅读 <a href="./guide.html#了解-package-json">了解 package.json</a> 一节，了解或重温 npm 包清单文件的作用</li><li>阅读 <a href="./guide.html#学习模块化设计">学习模块化设计</a> 一节，了解或重温模块化开发的知识</li></ol></div><h3 id="常用的构建工具" tabindex="-1">常用的构建工具 <a class="header-anchor" href="#常用的构建工具" aria-label="Permalink to &quot;常用的构建工具&quot;">​</a></h3><p>平时项目里用到的 npm 包，也可以理解为是一种项目插件，一些很简单的包，其实就和编写 <a href="#本地插件">本地插件</a> 一样，假设包的入口文件是 <code>index.js</code> ，那么可以直接在 <code>index.js</code> 里编写代码，再进行模块化导出。</p><p>其他项目里安装这个包之后就可以直接使用里面的方法了，这种方式适合非常非常简单的包，很多独立的工具函数包就是使用这种方式来编写包的源代码。</p><p>例如 <a href="https://www.npmjs.com/package/is-number" target="_blank" rel="noreferrer">is-number</a> 这个包，每周下载量超过 6800 万次，它的源代码非常少：</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * 摘自 is-number 的入口文件</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * </span><span style="color:#89DDFF;font-style:italic;">@</span><span style="color:#C792EA;font-style:italic;">see</span><span style="color:#676E95;font-style:italic;"> </span><span style="color:#BABED8;font-style:italic;">https://github.com/jonschlinkert/is-number/blob/master/index.js</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"><span style="color:#89DDFF;">module.exports</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">function</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">num</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">typeof</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">num</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">number</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">num</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">-</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">num</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">typeof</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">num</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">string</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">num</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">trim</span><span style="color:#F07178;">() </span><span style="color:#89DDFF;">!==</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;&#39;</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">Number</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">isFinite</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">?</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">Number</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">isFinite</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">+</span><span style="color:#BABED8;">num</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">isFinite</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">+</span><span style="color:#BABED8;">num</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">false</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>再如 <a href="https://www.npmjs.com/package/slash" target="_blank" rel="noreferrer">slash</a> 这个包，每周下载量超过 5200 万次，它的源代码也是只有几行：</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * 摘自 slash 的入口文件</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * </span><span style="color:#89DDFF;font-style:italic;">@</span><span style="color:#C792EA;font-style:italic;">see</span><span style="color:#676E95;font-style:italic;"> </span><span style="color:#BABED8;font-style:italic;">https://github.com/sindresorhus/slash/blob/main/index.js</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">default</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">function</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">slash</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">path</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">isExtendedLengthPath</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">/</span><span style="color:#89DDFF;font-style:italic;">^</span><span style="color:#BABED8;">\\\\\?\\</span><span style="color:#89DDFF;">/</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">test</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">path</span><span style="color:#F07178;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#BABED8;">isExtendedLengthPath</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">path</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">path</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">replace</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">/</span><span style="color:#BABED8;">\\</span><span style="color:#89DDFF;">/</span><span style="color:#F78C6C;">g</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">/</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>但这一类包通常是提供很基础的功能实现，更多时候需要自己开发的包更倾向于和框架、和业务挂钩，涉及到非 JavaScript 代码，例如 Vue 组件的编译、 Less 等 CSS 预处理器编译、 TypeScript 的编译等等，如果不通过构建工具来处理，那么发布后这个包的使用就会有诸多限制，需要满足和开发这个包时一样的开发环境才能使用，这对于使用者来说非常不友好。</p><p>因此大部分 npm 包的开发也需要用到构建工具来转换项目源代码，统一输出为一个兼容性更好、适用性更广的 JavaScript 文件，配合 <code>.d.ts</code> 文件的类型声明，使用者可以不需要特地配置就可以开箱即用，非常方便，非常友好。</p><p>传统的 <a href="https://github.com/webpack/webpack" target="_blank" rel="noreferrer">Webpack</a> 可以用来构建 npm 包文件，但按照目前更主流的技术选项，编译结果更干净更迷的当属 <a href="https://github.com/rollup/rollup" target="_blank" rel="noreferrer">Rollup</a> ，但 Rollup 需要配置很多插件功能，这对于刚接触包开发的开发者来说学习成本比较高，而 <a href="https://github.com/vitejs/vite" target="_blank" rel="noreferrer">Vite</a> 的出现则解决了这个难题，因为 Vite 的底层是基于 Rollup 来完成构建，上层则简化了很多配置上的问题，因此接下来将使用 Vite 来带领开发者入门 npm 包的开发。</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>在开始使用构建工具之前，请先在命令行使用 <code>node -v</code> 命令检查当前的 Node.js 版本号是否在构建工具的支持范围内，避免无法正常使用构建工具。</p><p>通常可以在构建工具的官网查询到其支持的 Node 版本，以 Vite 为例，可以在 Vite 官网的 <a href="https://cn.vitejs.dev/guide/migration.html#node-support" target="_blank" rel="noreferrer">Node 支持</a> 一节了解到当前只能在 Node 14.18+ / 16+ 版本上使用 Vite 。</p><p>当构建工具所支持的 Node 版本和常用的 Node 版本出现严重冲突时，推荐使用 <a href="https://github.com/nvm-sh/nvm" target="_blank" rel="noreferrer">nvm</a> / <a href="https://github.com/coreybutler/nvm-windows" target="_blank" rel="noreferrer">nvm-windows</a> 或者 <a href="https://github.com/tj/n" target="_blank" rel="noreferrer">n</a> 等 Node 版本管理工具安装多个不同版本的 Node ，即可根据开发需求很方便的切换不同版本的 Node 进行开发。</p></div><h3 id="项目结构与入口文件" tabindex="-1">项目结构与入口文件 <a class="header-anchor" href="#项目结构与入口文件" aria-label="Permalink to &quot;项目结构与入口文件&quot;">​</a></h3><p>在动手开发具体功能之前，先把项目框架搭起来，熟悉常用的项目结构，以及如何配置项目清单信息。</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>当前文档所演示的 hello-lib 项目已托管至 <a href="https://github.com/learning-vue3/hello-lib" target="_blank" rel="noreferrer">learning-vue3/hello-lib</a> 仓库，可使用 Git 克隆命令拉取至本地：</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 从 GitHub 克隆</span></span>
<span class="line"><span style="color:#FFCB6B;">git</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">clone</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">https://github.com/learning-vue3/hello-lib.git</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 如果 GitHub 访问失败，可以从 Gitee 克隆</span></span>
<span class="line"><span style="color:#FFCB6B;">git</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">clone</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">https://gitee.com/learning-vue3/hello-lib.git</span></span></code></pre></div><p>成品项目可作为学习过程中的代码参考，但更建议按照教程的讲解步骤，从零开始亲手搭建一个新项目并完成 npm 包的开发流程，可以更有效的提升学习效果。</p></div><h4 id="初始化项目" tabindex="-1">初始化项目 <a class="header-anchor" href="#初始化项目" aria-label="Permalink to &quot;初始化项目&quot;">​</a></h4><p>首先需要初始化一个 Node 项目，打开命令行工具，先使用 <code>cd</code> 命令进入平时存放项目的目录，再通过 <code>mkdir</code> 命令创建一个项目文件夹，这里起名为 <code>hello-lib</code> ：</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 创建一个项目文件夹</span></span>
<span class="line"><span style="color:#FFCB6B;">mkdir</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">hello-lib</span></span></code></pre></div><p>创建了项目文件夹之后，使用 <code>cd</code> 命令进入项目，执行 Node 的项目初始化命令：</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 进入项目文件夹</span></span>
<span class="line"><span style="color:#82AAFF;">cd</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">hello-lib</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 执行初始化，使其成为一个 Node 项目</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">init</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">-y</span></span></code></pre></div><p>此时 hello-lib 目录下会生成一个 package.json 文件，由于后面还需要手动调整该文件的信息，所以初始化的时候可以添加 <code>-y</code> 参数使用默认的初始化数据直接生成该文件，跳过答题环节。</p><h4 id="配置包信息" tabindex="-1">配置包信息 <a class="header-anchor" href="#配置包信息" aria-label="Permalink to &quot;配置包信息&quot;">​</a></h4><p>对一个 npm 包来说，最重要的文件莫过于 package.json 项目清单，其中有三个字段是必填的：</p><table><thead><tr><th style="text-align:center;"><span style="display:inline-block;width:80px;">字段</span></th><th style="text-align:center;"><span style="display:inline-block;width:80px;">是否必填</span></th><th>作用</th></tr></thead><tbody><tr><td style="text-align:center;">name</td><td style="text-align:center;">必填</td><td>npm 包的名称，遵循 <a href="./guide.html#项目名称规则">项目名称的规则</a></td></tr><tr><td style="text-align:center;">version</td><td style="text-align:center;">必填</td><td>npm 包的版本号，遵循 <a href="./guide.html#语义化版本号管理">语义化版本号的规则</a></td></tr><tr><td style="text-align:center;">main</td><td style="text-align:center;">必填</td><td>项目的入口文件，通常指向构建产物所在目录的某个文件，该文件通常包含了所有模块的导出。<br><br>如果只指定了 <code>main</code> 字段，则使用 <code>require</code> 和 <code>import</code> 以及浏览器访问 npm 包的 CDN 时，都将默认调用该字段指定的入口文件。<br><br>如果有指定 <code>module</code> 和 <code>browser</code> 字段，则通常对应 <code>cjs</code> 格式的文件，对应 CommonJS 规范。</td></tr><tr><td style="text-align:center;">module</td><td style="text-align:center;">否</td><td>当项目使用 <code>import</code> 引入 npm 包时对应的入口文件，通常指向一个 <code>es</code> 格式的文件，对应 ES Module 规范。</td></tr><tr><td style="text-align:center;">browser</td><td style="text-align:center;">否</td><td>当项目使用了 npm 包的 CDN 链接，在浏览器访问页面时的入口文件，通常指向一个 <code>umd</code> 格式的文件，对应 UMD 规范。</td></tr><tr><td style="text-align:center;">types</td><td style="text-align:center;">否</td><td>一个 <code>.d.ts</code> 类型声明文件，包含了入口文件导出的方法 / 变量的类型声明，如果项目有自带类型文件，那么在使用者在使用 TypeScript 开发的项目里，可以得到友好的类型提示</td></tr><tr><td style="text-align:center;">files</td><td style="text-align:center;">否</td><td>指定发布到 npm 上的文件范围，格式为 <code>string[]</code> 支持配置多个文件名或者文件夹名称。<br><br>通常可以只指定构建的输出目录，例如 <code>dist</code> 文件夹，如果不指定，则发布的时候会把所有源代码一同发布。</td></tr></tbody></table><p>其中 <code>main</code> 、 <code>module</code> 和 <code>browser</code> 三个入口文件对应的文件格式和规范，通常都是交给构建工具处理，无需手动编写，开发者只需要维护一份源码即可编译出不同规范的 JS 文件， <code>types</code> 对应的类型声明文件也是由工具来输出，无需手动维护。</p><p>而其他的字段可以根据项目的性质决定是否补充，以下是 hello-lib 的基础信息示例：</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">name</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">@learning-vue3/lib</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">version</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">1.0.0</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">description</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">A library demo for learning-vue3.</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">author</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">chengpeiquan &lt;chengpeiquan@chengpeiquan.com&gt;</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">homepage</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">https://github.com/learning-vue3/hello-lib</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">repository</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">type</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">git</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">url</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">git+https://github.com/learning-vue3/hello-lib.git</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">license</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">MIT</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">files</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">dist</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">],</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">main</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">dist/index.cjs</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">module</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">dist/index.mjs</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">browser</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">dist/index.min.js</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">types</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">dist/index.d.ts</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">keywords</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">library</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">demo</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">example</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">],</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">scripts</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">build</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">vite build</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>此时 <code>main</code> 、 <code>module</code> 、 <code>browser</code> 和 <code>types</code> 字段对应的文件还不存在，它们将在项目执行 <code>npm run build</code> 构建之后才会产生。</p><p>另外，入口文件使用了不同规范对应的文件扩展名，也可以统一使用 <code>.js</code> 扩展名，通过文件名来区分，例如 <code>es</code> 格式使用 <code>index.es.js</code> 。</p><p>而 <code>scripts</code> 字段则配置了一个 <code>build</code> 命令，这里使用了 Vite 的构建命令来打包项目，这个过程会读取 Vite 的配置文件 <code>vite.config.ts</code> ，关于该文件的配置内容将在下文继续介绍。</p><h4 id="安装开发依赖" tabindex="-1">安装开发依赖 <a class="header-anchor" href="#安装开发依赖" aria-label="Permalink to &quot;安装开发依赖&quot;">​</a></h4><p>本次的 npm 包将使用 Vite 进行构建，使用 TypeScript 编写源代码，由于 Vite 本身对 TypeScript 进行了支持，因此只需要将 Vite 安装到开发依赖：</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 添加 -D 选项将其安装到 devDependencies</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">i</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">-D</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">vite</span></span></code></pre></div><h4 id="添加配置文件" tabindex="-1">添加配置文件 <a class="header-anchor" href="#添加配置文件" aria-label="Permalink to &quot;添加配置文件&quot;">​</a></h4><p>在 <a href="#配置包信息">配置包信息</a> 的时候已提前配置了一个 <code>npm run build</code> 的命令，它将运行 Vite 来构建 npm 包的入口文件。</p><p>由于 Vite 默认是构建入口文件为 HTML 的网页应用，而开发 npm 包时入口文件是 JS / TS 文件，因此需要添加一份配置文件来指定构建的选项。</p><p>以下是本次的基础配置，可以完成最基本的打包，它将输出三个不同格式的入口文件，分别对应 CommonJS 、 ES Module 和 UMD 规范，分别对应 package.json 里 <code>main</code> 、 <code>module</code> 和 <code>browser</code> 字段指定的文件。</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// vite.config.ts</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">defineConfig</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vite</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// https://cn.vitejs.dev/config/</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">default</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">defineConfig</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">build</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// 输出目录</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F07178;">outDir</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">dist</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// 构建 npm 包时需要开启 “库模式”</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F07178;">lib</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// 指定入口文件</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#F07178;">entry</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">src/index.ts</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// 输出 UMD 格式时，需要指定一个全局变量的名称</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#F07178;">name</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">hello</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// 最终输出的格式，这里指定了三种</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#F07178;">formats</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">es</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">cjs</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">umd</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;font-style:italic;">// 针对不同输出格式对应的文件名</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#82AAFF;">fileName</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">format</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">switch</span><span style="color:#F07178;"> (</span><span style="color:#BABED8;">format</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">          </span><span style="color:#676E95;font-style:italic;">// ES Module 格式的文件名</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;font-style:italic;">case</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">es</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">index.mjs</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;">          </span><span style="color:#676E95;font-style:italic;">// CommonJS 格式的文件名</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;font-style:italic;">case</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">cjs</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">index.cjs</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;">          </span><span style="color:#676E95;font-style:italic;">// UMD 格式的文件名</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#89DDFF;font-style:italic;">default</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">index.min.js</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// 压缩混淆构建后的文件代码</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F07178;">minify</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span></span></code></pre></div><h4 id="添加入口文件" tabindex="-1">添加入口文件 <a class="header-anchor" href="#添加入口文件" aria-label="Permalink to &quot;添加入口文件&quot;">​</a></h4><p>来到这里，最基础的准备工作已完成，接下来添加入口文件并尝试编译。</p><p>在 <a href="#添加配置文件">添加配置文件</a> 时已指定了入口文件为 src/index.ts ，因此需要对应的创建该文件，并写入一个简单的方法，将用它来测试打包结果：</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// src/index.ts</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">default</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">function</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">hello</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">name</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">`</span><span style="color:#C3E88D;">Hello </span><span style="color:#89DDFF;">${</span><span style="color:#BABED8;">name</span><span style="color:#89DDFF;">}`</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>在命令行执行 <code>npm run build</code> 命令，可以看到项目下生成了 dist 文件夹，以及三个 JavaScript 文件，此时目录结构如下：</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">hello-lib</span></span>
<span class="line"><span style="color:#FFCB6B;">│</span><span style="color:#BABED8;"> </span><span style="color:#676E95;font-style:italic;"># 构建产物的输出文件夹</span></span>
<span class="line"><span style="color:#FFCB6B;">├─dist</span></span>
<span class="line"><span style="color:#FFCB6B;">│</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">├─index.cjs</span></span>
<span class="line"><span style="color:#FFCB6B;">│</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">├─index.min.js</span></span>
<span class="line"><span style="color:#FFCB6B;">│</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">└─index.mjs</span></span>
<span class="line"><span style="color:#FFCB6B;">│</span><span style="color:#BABED8;"> </span><span style="color:#676E95;font-style:italic;"># 依赖文件夹</span></span>
<span class="line"><span style="color:#FFCB6B;">├─node_modules</span></span>
<span class="line"><span style="color:#FFCB6B;">│</span><span style="color:#BABED8;"> </span><span style="color:#676E95;font-style:italic;"># 源码文件夹</span></span>
<span class="line"><span style="color:#FFCB6B;">├─src</span></span>
<span class="line"><span style="color:#FFCB6B;">│</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">│</span><span style="color:#BABED8;"> </span><span style="color:#676E95;font-style:italic;"># 入口文件</span></span>
<span class="line"><span style="color:#FFCB6B;">│</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">└─index.ts</span></span>
<span class="line"><span style="color:#FFCB6B;">│</span><span style="color:#BABED8;"> </span><span style="color:#676E95;font-style:italic;"># 项目清单信息</span></span>
<span class="line"><span style="color:#FFCB6B;">├─package-lock.json</span></span>
<span class="line"><span style="color:#FFCB6B;">├─package.json</span></span>
<span class="line"><span style="color:#FFCB6B;">│</span><span style="color:#BABED8;"> </span><span style="color:#676E95;font-style:italic;"># Vite 配置文件</span></span>
<span class="line"><span style="color:#FFCB6B;">└─vite.config.ts</span></span></code></pre></div><p>打开 dist 目录下的文件内容，可以看到虽然源码是使用 TypeScript 编写的，但最终输出的内容是按照指定的格式转换为 JavaScript 并且被执行了压缩和混淆，在这里将它们重新格式化，来看看转换后的结果。</p><p>这是 index.cjs 的文件内容，源码被转换为 CommonJS 风格的代码：</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// dist/index.cjs</span></span>
<span class="line"><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">use strict</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">l</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">o</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">`</span><span style="color:#C3E88D;">Hello </span><span style="color:#89DDFF;">${</span><span style="color:#BABED8;">o</span><span style="color:#89DDFF;">}`</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">module.exports</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> l</span></span></code></pre></div><p>这是 index.mjs 的内容，源码被转换为 ES Module 风格的代码：</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// dist/index.mjs</span></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">o</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">l</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">`</span><span style="color:#C3E88D;">Hello </span><span style="color:#89DDFF;">${</span><span style="color:#BABED8;">l</span><span style="color:#89DDFF;">}`</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">o</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">as</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">default</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span></span></code></pre></div><p>这是 index.min.js 的内容，源码被转换为 UMD 风格的代码：</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// dist/index.min.js</span></span>
<span class="line"><span style="color:#89DDFF;">;</span><span style="color:#BABED8;">(</span><span style="color:#C792EA;">function</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">e</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">n</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">typeof</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">exports</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">==</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">object</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">typeof</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">module</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">u</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">?</span><span style="color:#F07178;"> (</span><span style="color:#FFCB6B;">module</span><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">exports</span><span style="color:#F07178;"> = </span><span style="color:#FFCB6B;">n</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">typeof</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">define</span><span style="color:#F07178;"> == </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">function</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">define</span><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">amd</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">?</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">define</span><span style="color:#F07178;">(</span><span style="color:#FFCB6B;">n</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">e</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">typeof</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">globalThis</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">u</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">?</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">globalThis</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">e</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">||</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">self</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        (</span><span style="color:#FFCB6B;">e</span><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">hello</span><span style="color:#F07178;"> = </span><span style="color:#FFCB6B;">n</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;">))</span></span>
<span class="line"><span style="color:#F07178;">})(this, function () {</span></span>
<span class="line"><span style="color:#F07178;">  &#39;use strict&#39;</span></span>
<span class="line"><span style="color:#F07178;">  function e</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">n</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#FFCB6B;">console</span><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">`</span><span style="color:#C3E88D;">Hello </span><span style="color:#89DDFF;">${</span><span style="color:#FFCB6B;">n</span><span style="color:#89DDFF;">}`</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">return</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">e</span></span>
<span class="line"><span style="color:#F07178;">})</span></span></code></pre></div><p>来到这里，准备工作已就绪，下一步将开始进入工具包和组件包的开发。</p><h3 id="开发-npm-包" tabindex="-1">开发 npm 包 <a class="header-anchor" href="#开发-npm-包" aria-label="Permalink to &quot;开发 npm 包&quot;">​</a></h3><p>这里先从最简单的函数库开始入门包的开发，为什么说它简单呢？因为只需要编写 JavaScript 或 TypeScript 就可以很好的完成开发工作。</p><p>在理解了包的开发流程之后，如果要涉及 Vue 组件包的开发，则安装相关的 Vue 的相关依赖、 Less 等 CSS 预处理器依赖，只要满足了编译条件，就可以正常构建和发布，它们的开发流程是一样的。</p><h4 id="编写-npm-包代码" tabindex="-1">编写 npm 包代码 <a class="header-anchor" href="#编写-npm-包代码" aria-label="Permalink to &quot;编写 npm 包代码&quot;">​</a></h4><p>在开发的过程中，需要遵循模块化开发的要求，当前这个演示包使用 TypeScript 编码，就需要 <a href="./guide.html#用-es-module-设计模块">使用 ES Module 来设计模块</a> ，如果对模块化设计还没有足够的了解，请先回顾相关的内容。</p><p>先在 src 目录下创建一个名为 utils.ts 的文件，写入以下内容：</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// src/utils.ts</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * 生成随机数</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * </span><span style="color:#89DDFF;font-style:italic;">@</span><span style="color:#C792EA;font-style:italic;">param</span><span style="color:#676E95;font-style:italic;"> </span><span style="color:#BABED8;font-style:italic;">min</span><span style="color:#676E95;font-style:italic;"> - 最小值</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * </span><span style="color:#89DDFF;font-style:italic;">@</span><span style="color:#C792EA;font-style:italic;">param</span><span style="color:#676E95;font-style:italic;"> </span><span style="color:#BABED8;font-style:italic;">max</span><span style="color:#676E95;font-style:italic;"> - 最大值</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * </span><span style="color:#89DDFF;font-style:italic;">@</span><span style="color:#C792EA;font-style:italic;">param</span><span style="color:#676E95;font-style:italic;"> </span><span style="color:#BABED8;font-style:italic;">roundingType</span><span style="color:#676E95;font-style:italic;"> - 四舍五入类型</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * </span><span style="color:#89DDFF;font-style:italic;">@</span><span style="color:#C792EA;font-style:italic;">returns</span><span style="color:#676E95;font-style:italic;"> 范围内的随机数</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">function</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">getRandomNumber</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#BABED8;font-style:italic;">min</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">number</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#BABED8;font-style:italic;">max</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">number</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">100</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#BABED8;font-style:italic;">roundingType</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">round</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">|</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ceil</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">|</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">floor</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">round</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">Math</span><span style="color:#F07178;">[</span><span style="color:#BABED8;">roundingType</span><span style="color:#F07178;">](</span><span style="color:#BABED8;">Math</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">random</span><span style="color:#F07178;">() </span><span style="color:#89DDFF;">*</span><span style="color:#F07178;"> (</span><span style="color:#BABED8;">max</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">-</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">min</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">min</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * 生成随机布尔值</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">function</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">getRandomBoolean</span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">index</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">getRandomNumber</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">1</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> [</span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#F07178;">][</span><span style="color:#BABED8;">index</span><span style="color:#F07178;">]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>这里导出了两个随机方法，其中 <code>getRandomNumber</code> 提供了随机数值的返回，而 <code>getRandomBoolean</code> 提供了随机布尔值的返回，在源代码方面， <code>getRandomBoolean</code> 调用了 <code>getRandomNumber</code> 获取随机索引。</p><p>这是一个很常见的 npm 工具包的开发思路，包里的函数都使用了细粒度的编程设计，每一个函数都是独立的功能，在必要的情况下，函数 B 可以调用函数 A 来减少代码的重复编写。</p><p>在这里， utils.ts 文件已开发完毕，接下来需要将它导出的方法提供给包的使用者，请删除入口文件 src/index.ts 原来的测试内容，并输入以下新代码：</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// src/index.ts</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">*</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./utils</span><span style="color:#89DDFF;">&#39;</span></span></code></pre></div><p>这代表将 utils.ts 文件里导出的所有方法或者变量，再次导出去，如果有很多个 utils.ts 这样的文件， index.ts 将作为一个统一的入口，统一的导出给构建工具去编译输出。</p><p>接下来在命令行执行 <code>npm run build</code> ，再分别看看 dist 目录下的文件变化：</p><p>此时的 index.cjs 文件，已经按照 CommonJS 规范转换了源代码：</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// dist/index.cjs</span></span>
<span class="line"><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">use strict</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#BABED8;">Object</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">defineProperties</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">exports,</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">__esModule</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">value</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">!</span><span style="color:#F78C6C;">0</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">[</span><span style="color:#BABED8;">Symbol</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">toStringTag</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#BABED8;"> </span><span style="color:#F07178;">value</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Module</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">t</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">e</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">o</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">100</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">n</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">round</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">Math</span><span style="color:#F07178;">[</span><span style="color:#BABED8;">n</span><span style="color:#F07178;">](</span><span style="color:#BABED8;">Math</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">random</span><span style="color:#F07178;">() </span><span style="color:#89DDFF;">*</span><span style="color:#F07178;"> (</span><span style="color:#BABED8;">o</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">-</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">e</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">e</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">r</span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">e</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">t</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">1</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> [</span><span style="color:#89DDFF;">!</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!</span><span style="color:#F78C6C;">1</span><span style="color:#F07178;">][</span><span style="color:#BABED8;">e</span><span style="color:#F07178;">]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">exports.</span><span style="color:#BABED8;">getRandomBoolean </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> r</span></span>
<span class="line"><span style="color:#89DDFF;">exports.</span><span style="color:#BABED8;">getRandomNumber </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> t</span></span></code></pre></div><p>index.mjs 也按照 ES Module 规范进行了转换：</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// dist/index.mjs</span></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">o</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">n</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">t</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">100</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">e</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">round</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">Math</span><span style="color:#F07178;">[</span><span style="color:#BABED8;">e</span><span style="color:#F07178;">](</span><span style="color:#BABED8;">Math</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">random</span><span style="color:#F07178;">() </span><span style="color:#89DDFF;">*</span><span style="color:#F07178;"> (</span><span style="color:#BABED8;">t</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">-</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">n</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">n</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">r</span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">n</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">o</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">1</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> [</span><span style="color:#89DDFF;">!</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!</span><span style="color:#F78C6C;">1</span><span style="color:#F07178;">][</span><span style="color:#BABED8;">n</span><span style="color:#F07178;">]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">r</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">as</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">getRandomBoolean</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">o</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">as</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">getRandomNumber</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span></span></code></pre></div><p>index.min.js 同样正常按照 UMD 风格转换成了 JavaScript 代码：</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// dist/index.min.js</span></span>
<span class="line"><span style="color:#89DDFF;">;</span><span style="color:#BABED8;">(</span><span style="color:#C792EA;">function</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">e</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">n</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">typeof</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">exports</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">==</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">object</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">typeof</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">module</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">u</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">?</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">n</span><span style="color:#F07178;">(</span><span style="color:#FFCB6B;">exports</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">typeof</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">define</span><span style="color:#F07178;"> == </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">function</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">define</span><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">amd</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">?</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">define</span><span style="color:#F07178;">([</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">exports</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">n</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">e</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">typeof</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">globalThis</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">u</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">?</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">globalThis</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">e</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">||</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">self</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#FFCB6B;">n</span><span style="color:#F07178;">((</span><span style="color:#FFCB6B;">e</span><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">hello</span><span style="color:#F07178;"> = </span><span style="color:#89DDFF;">{}</span><span style="color:#F07178;">)))</span></span>
<span class="line"><span style="color:#F07178;">})(this, function (e) {</span></span>
<span class="line"><span style="color:#F07178;">  &#39;use strict&#39;</span></span>
<span class="line"><span style="color:#F07178;">  function n</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">o</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;font-style:italic;">u</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">100</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;font-style:italic;">d</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">round</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#FFCB6B;">return</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">Math</span><span style="color:#F07178;">[</span><span style="color:#FFCB6B;">d</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">(</span><span style="color:#F07178;">Math.random(</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">*</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">u</span><span style="color:#F07178;"> - </span><span style="color:#BABED8;font-style:italic;">o</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> + o)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#FFCB6B;">function</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">t</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#FFCB6B;">const</span><span style="color:#F07178;"> o </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> n(</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">1</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#FFCB6B;">return</span><span style="color:#F07178;"> [!</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> !</span><span style="color:#F78C6C;">1</span><span style="color:#F07178;">][</span><span style="color:#BABED8;">o</span><span style="color:#F07178;">]</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  ;(</span><span style="color:#FFCB6B;">e</span><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">getRandomBoolean</span><span style="color:#F07178;"> = </span><span style="color:#FFCB6B;">t</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    (</span><span style="color:#FFCB6B;">e</span><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">getRandomNumber</span><span style="color:#F07178;"> = </span><span style="color:#FFCB6B;">n</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#FFCB6B;">Object</span><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">defineProperties</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">e</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      __esModule</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> value</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> !</span><span style="color:#F78C6C;">0</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">      [</span><span style="color:#BABED8;">Symbol</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">toStringTag</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> value</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Module</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">})</span></span>
<span class="line"><span style="color:#F07178;">})</span></span></code></pre></div><h4 id="对-npm-包进行本地调试" tabindex="-1">对 npm 包进行本地调试 <a class="header-anchor" href="#对-npm-包进行本地调试" aria-label="Permalink to &quot;对 npm 包进行本地调试&quot;">​</a></h4><p>开发或者迭代了一个 npm 包之后，不建议直接发布，可以在本地进行测试，直到没有问题了再发布到 npmjs 上供其他人使用。</p><p>npm 提供了一个 <code>npm link</code> 命令供开发者本地联调，假设 <code>path/to/my-library</code> 是一个 npm 包的项目路径， <code>path/to/my-project</code> 是一个调试项目的所在路径，那么通过以下步骤可以在 <code>my-project</code> 里本地调试 <code>my-library</code> 包。</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>关于 <code>path/to</code> 的典故，可以查看 <a href="https://github.com/chengpeiquan/learning-vue3/issues/294" target="_blank" rel="noreferrer">#294</a> 了解。</p></div><h5 id="创建本地软链接" tabindex="-1">创建本地软链接 <a class="header-anchor" href="#创建本地软链接" aria-label="Permalink to &quot;创建本地软链接&quot;">​</a></h5><p>先在 <code>my-library</code> npm 包项目里执行 <code>npm link</code> 命令，创建 npm 包的本地软链接：</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 进入 npm 包项目所在的目录</span></span>
<span class="line"><span style="color:#82AAFF;">cd</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">path/to/my-library</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 创建 npm 包的本地软链接</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">link</span></span></code></pre></div><p>运行了以上命令之后，意味着刚刚开发好的 npm 包，已经被成功添加到了 Node 的全局安装目录下，可以在命令行运行以下命令查看全局安装目录的位置：</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">prefix</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">-g</span></span></code></pre></div><p>假设 <code>{prefix}</code> 是全局安装目录，刚刚这个包在 package.json 里的包名称是 <code>my-library</code> ，那么在 <code>{prefix}/node_modules/my-library</code> 这个目录下可以看到被软链接了一份项目代码。</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>软链接（ Symbolic Link / Symlink / Soft Link ），是指通过指定路径来指向文件或目录，操作系统会自动将其解释为另一个文件或目录的路径，因此软链接被删除或修改不会影响源文件，而源文件的移动或者删除，不会自动更新软链接，这一点和快捷方式的作用比较类似。</p></div><p>自此已经对这个 npm 包完成了一次 “本地发布” ，接下来就要在调试项目里进行本地关联。</p><h5 id="关联本地软链接" tabindex="-1">关联本地软链接 <a class="header-anchor" href="#关联本地软链接" aria-label="Permalink to &quot;关联本地软链接&quot;">​</a></h5><p>在 <code>my-project</code> 调试项目里执行语法为 <code>npm link [&lt;package-spec&gt;]</code> 的 link 命令，关联 npm 包的本地软链接。</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>这里的 <code>[&lt;package-spec&gt;]</code> 参数，可以是包名称，也可以是 npm 包项目所在的路径。</p></div><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 进入调试项目所在的目录</span></span>
<span class="line"><span style="color:#82AAFF;">cd</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">path/to/my-project</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 通过 npm 包的包名称关联本地软链接</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">link</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">my-library</span></span></code></pre></div><p>如果通过 npm 包名称关联失败，例如返回了如下信息：</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">❯</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">link</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">my-library</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">ERR!</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">code</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">E404</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">ERR!</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">404</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">Not</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">Found</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">-</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">GET</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">https://registry.npmjs.org/my-library</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">-</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">Not</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">found</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">ERR!</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">404</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">ERR!</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">404</span><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">my-library@*</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">is</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">not</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">in</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">this</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">registry.</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">ERR!</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">404</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">ERR!</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">404</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">Note</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">that</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">you</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">can</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">also</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">install</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">from</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">a</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">ERR!</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">404</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">tarball,</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">folder,</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">http</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">url,</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">or</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">git</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">url.</span></span></code></pre></div><p>这种情况通常出现于本地 npm 包还没有在 npmjs 上进行过任意版本的发布，而包管理器又找不到本地全局安装目录的软链接，就会去 npm 源找，都找不到就会返回 404 的报错，针对这种情况，也可以使用 npm 包项目的路径进行关联：</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 进入调试项目所在的目录</span></span>
<span class="line"><span style="color:#82AAFF;">cd</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">path/to/my-project</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 通过 npm 包的项目路径关联本地软链接</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">link</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">path/to/my-library</span></span></code></pre></div><p>至此，就完成了调试项目对该 npm 包在本地的 “安装” ，此时在 <code>my-project</code> 这个调试项目的 node_modules 目录下也会创建一个软链接，指向 <code>my-library</code> 所在的目录。</p><p>回归当前的演示包项目，先创建一个基于 TypeScript 的 Vue 新项目作为调试项目，在关联了本地 npm 包之后，就可以在调试项目里编写如下代码，测试 npm 包里的方法是否可以正常使用：</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// 请将 `@learning-vue3/lib` 更换为实际的包名称</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">getRandomNumber</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@learning-vue3/lib</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> num </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">getRandomNumber</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#BABED8;">(num)</span></span></code></pre></div><p>启动 <code>npm run dev</code> 的调试命令并打开本地调试页面，就可以在浏览器控制台正确的打印出了随机结果。</p><p>因为本包还支持 UMD 规范，所以也可以在 HTML 页面通过普通的 <code>&lt;script /&gt;</code> 标签直接引入 dist 目录下的文件测试将来引入 CDN 时的效果，可以在 npm 包项目下创建一个 demo 目录，并添加一个 index.html 文件到该目录下，并写入以下内容：</p><div class="language-html"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">&lt;!-- demo/index.html --&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;!</span><span style="color:#F07178;">DOCTYPE</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">html</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">html</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">lang</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">en</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">head</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">meta</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">charset</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">UTF-8</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> /&gt;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">meta</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">http-equiv</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">X-UA-Compatible</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">content</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">IE=edge</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> /&gt;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">meta</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">name</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">viewport</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">content</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">width=device-width, initial-scale=1.0</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> /&gt;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">title</span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;">Library Demo</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">title</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">head</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">body</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;">&lt;!-- 这里引入的是 UMD 规范的文件 --&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">    &lt;</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">src</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">../dist/index.min.js</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;&lt;/</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">    &lt;</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#676E95;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">       * UMD 规范的文件会有一个全局变量</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">       * 由 vite.config.ts 的 `build.lib.name` 决定</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">       */</span></span>
<span class="line"><span style="color:#BABED8;">      console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#BABED8;">(hello)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#676E95;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">       * 所有的方法会挂在这个全局变量上</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">       * 类似于 jQuery 的 $.xxx() 那样使用</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">       */</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> num </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> hello</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getRandomNumber</span><span style="color:#BABED8;">()</span></span>
<span class="line"><span style="color:#BABED8;">      console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#BABED8;">(num)</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">body</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">html</span><span style="color:#89DDFF;">&gt;</span></span></code></pre></div><p>在浏览器打开该 HTML 文件并唤起控制台，一样可以看到随机结果的打印记录。</p><h4 id="添加版权注释" tabindex="-1">添加版权注释 <a class="header-anchor" href="#添加版权注释" aria-label="Permalink to &quot;添加版权注释&quot;">​</a></h4><p>很多知名项目在 Library 文件的开头都会有一段版权注释，它的作用除了声明版权归属之外，还会告知使用者关于项目的主页地址、版本号、发布日期、 BUG 反馈渠道等信息。</p><p>例如很多开发者入门前端时使用过的经典类库 jQuery :</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight has-highlighted-lines"><code><span class="line"><span style="color:#676E95;font-style:italic;">// https://cdn.jsdelivr.net/npm/jquery@3.6.1/dist/jquery.js</span></span>
<span class="line"></span>
<span class="line highlighted"><span style="color:#676E95;font-style:italic;">/*!</span></span>
<span class="line highlighted"><span style="color:#676E95;font-style:italic;"> * jQuery JavaScript Library v3.6.1</span></span>
<span class="line highlighted"><span style="color:#676E95;font-style:italic;"> * https://jquery.com/</span></span>
<span class="line highlighted"><span style="color:#676E95;font-style:italic;"> *</span></span>
<span class="line highlighted"><span style="color:#676E95;font-style:italic;"> * Includes Sizzle.js</span></span>
<span class="line highlighted"><span style="color:#676E95;font-style:italic;"> * https://sizzlejs.com/</span></span>
<span class="line highlighted"><span style="color:#676E95;font-style:italic;"> *</span></span>
<span class="line highlighted"><span style="color:#676E95;font-style:italic;"> * Copyright OpenJS Foundation and other contributors</span></span>
<span class="line highlighted"><span style="color:#676E95;font-style:italic;"> * Released under the MIT license</span></span>
<span class="line highlighted"><span style="color:#676E95;font-style:italic;"> * https://jquery.org/license</span></span>
<span class="line highlighted"><span style="color:#676E95;font-style:italic;"> *</span></span>
<span class="line highlighted"><span style="color:#676E95;font-style:italic;"> * Date: 2022-08-26T17:52Z</span></span>
<span class="line highlighted"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"><span style="color:#BABED8;">( </span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">global</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">factory</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// ...</span></span></code></pre></div><p>又如流行的 JavaScript 工具库 Lodash :</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight has-highlighted-lines"><code><span class="line"><span style="color:#676E95;font-style:italic;">// https://cdn.jsdelivr.net/npm/lodash@4.17.21/lodash.min.js</span></span>
<span class="line"></span>
<span class="line highlighted"><span style="color:#676E95;font-style:italic;">/**</span></span>
<span class="line highlighted"><span style="color:#676E95;font-style:italic;"> * </span><span style="color:#89DDFF;font-style:italic;">@</span><span style="color:#C792EA;font-style:italic;">license</span></span>
<span class="line highlighted"><span style="color:#676E95;font-style:italic;"> * Lodash &lt;https://lodash.com/&gt;</span></span>
<span class="line highlighted"><span style="color:#676E95;font-style:italic;"> * Copyright OpenJS Foundation and other contributors &lt;https://openjsf.org/&gt;</span></span>
<span class="line highlighted"><span style="color:#676E95;font-style:italic;"> * Released under MIT license &lt;https://lodash.com/license&gt;</span></span>
<span class="line highlighted"><span style="color:#676E95;font-style:italic;"> * Based on Underscore.js 1.8.3 &lt;http://underscorejs.org/LICENSE&gt;</span></span>
<span class="line highlighted"><span style="color:#676E95;font-style:italic;"> * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters &amp; Editors</span></span>
<span class="line highlighted"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"><span style="color:#BABED8;">(</span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(){</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// ...</span></span></code></pre></div><p>还有每次做轮播图一定会想到它的 Swiper ：</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight has-highlighted-lines"><code><span class="line"><span style="color:#676E95;font-style:italic;">// https://cdn.jsdelivr.net/npm/swiper@8.4.3/swiper-bundle.js</span></span>
<span class="line"></span>
<span class="line highlighted"><span style="color:#676E95;font-style:italic;">/**</span></span>
<span class="line highlighted"><span style="color:#676E95;font-style:italic;"> * Swiper 8.4.3</span></span>
<span class="line highlighted"><span style="color:#676E95;font-style:italic;"> * Most modern mobile touch slider and framework</span></span>
<span class="line highlighted"><span style="color:#676E95;font-style:italic;"> * with hardware accelerated transitions</span></span>
<span class="line highlighted"><span style="color:#676E95;font-style:italic;"> * https://swiperjs.com</span></span>
<span class="line highlighted"><span style="color:#676E95;font-style:italic;"> *</span></span>
<span class="line highlighted"><span style="color:#676E95;font-style:italic;"> * Copyright 2014-2022 Vladimir Kharlampidi</span></span>
<span class="line highlighted"><span style="color:#676E95;font-style:italic;"> *</span></span>
<span class="line highlighted"><span style="color:#676E95;font-style:italic;"> * Released under the MIT License</span></span>
<span class="line highlighted"><span style="color:#676E95;font-style:italic;"> *</span></span>
<span class="line highlighted"><span style="color:#676E95;font-style:italic;"> * Released on: October 6, 2022</span></span>
<span class="line highlighted"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"><span style="color:#BABED8;">(</span><span style="color:#C792EA;">function</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">global</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">factory</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// ...</span></span></code></pre></div><p>聪明的开发者肯定已经猜到了，这些版权注释肯定不是手动添加的，那么它们是如何自动生成的呢？</p><p>npm 社区提供了非常多开箱即用的注入插件，通常可以通过 “当前使用的构建工具名称” 加上 “plugin banner” 这样的关键字，在 npmjs 网站上搜索是否有相关的插件，以当前使用的 Vite 为例，可以通过 <a href="https://www.npmjs.com/package/vite-plugin-banner" target="_blank" rel="noreferrer">vite-plugin-banner</a> 实现版权注释的自动注入。</p><p>回到 hello-lib 项目，安装该插件到 devDependencies ：</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">i</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">-D</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">vite-plugin-banner</span></span></code></pre></div><p>根据插件的文档建议，打开 vite.config.ts 文件，将其导入，并通过读取 package.json 的信息来生成常用的版权注释信息：</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight has-highlighted-lines"><code><span class="line"><span style="color:#676E95;font-style:italic;">// vite.config.ts</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">defineConfig</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vite</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line highlighted"><span style="color:#676E95;font-style:italic;">// 导入版权注释插件</span></span>
<span class="line highlighted"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> banner </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vite-plugin-banner</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line highlighted"><span style="color:#676E95;font-style:italic;">// 导入 npm 包信息</span></span>
<span class="line highlighted"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> pkg </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./package.json</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// https://cn.vitejs.dev/config/</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">default</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">defineConfig</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// 其他选项保持不变</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// ...</span></span>
<span class="line highlighted"><span style="color:#BABED8;">  </span><span style="color:#F07178;">plugins</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> [</span></span>
<span class="line highlighted"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// 新增 banner 插件的启用，传入 package.json 的字段信息</span></span>
<span class="line highlighted"><span style="color:#BABED8;">    </span><span style="color:#82AAFF;">banner</span><span style="color:#BABED8;">(</span></span>
<span class="line highlighted"><span style="color:#BABED8;">      </span><span style="color:#89DDFF;">`</span><span style="color:#C3E88D;">/**</span><span style="color:#BABED8;">\n</span><span style="color:#C3E88D;"> * name: </span><span style="color:#89DDFF;">${</span><span style="color:#BABED8;">pkg</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">name</span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">\n</span><span style="color:#C3E88D;"> * version: v</span><span style="color:#89DDFF;">${</span><span style="color:#BABED8;">pkg</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">version</span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">\n</span><span style="color:#C3E88D;"> * description: </span><span style="color:#89DDFF;">${</span><span style="color:#BABED8;">pkg</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">description</span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">\n</span><span style="color:#C3E88D;"> * author: </span><span style="color:#89DDFF;">${</span><span style="color:#BABED8;">pkg</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">author</span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">\n</span><span style="color:#C3E88D;"> * homepage: </span><span style="color:#89DDFF;">${</span><span style="color:#BABED8;">pkg</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">homepage</span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">\n</span><span style="color:#C3E88D;"> */</span><span style="color:#89DDFF;">`</span></span>
<span class="line highlighted"><span style="color:#BABED8;">    )</span><span style="color:#89DDFF;">,</span></span>
<span class="line highlighted"><span style="color:#BABED8;">  ]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span></span></code></pre></div><p>再次运行 <code>npm run build</code> 命令，打开 dist 目录下的 Library 文件，可以看到都成功添加了一段版权注释：</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight has-highlighted-lines"><code><span class="line"><span style="color:#676E95;font-style:italic;">// dist/index.mjs</span></span>
<span class="line"></span>
<span class="line highlighted"><span style="color:#676E95;font-style:italic;">/**</span></span>
<span class="line highlighted"><span style="color:#676E95;font-style:italic;"> * name: @learning-vue3/lib</span></span>
<span class="line highlighted"><span style="color:#676E95;font-style:italic;"> * version: v1.0.0</span></span>
<span class="line highlighted"><span style="color:#676E95;font-style:italic;"> * description: A library demo for learning-vue3.</span></span>
<span class="line highlighted"><span style="color:#676E95;font-style:italic;"> * author: chengpeiquan &lt;chengpeiquan@chengpeiquan.com&gt;</span></span>
<span class="line highlighted"><span style="color:#676E95;font-style:italic;"> * homepage: https://github.com/learning-vue3/hello-lib</span></span>
<span class="line highlighted"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">o</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">n</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">t</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">100</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">e</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">round</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">Math</span><span style="color:#F07178;">[</span><span style="color:#BABED8;">e</span><span style="color:#F07178;">](</span><span style="color:#BABED8;">Math</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">random</span><span style="color:#F07178;">() </span><span style="color:#89DDFF;">*</span><span style="color:#F07178;"> (</span><span style="color:#BABED8;">t</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">-</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">n</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">n</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">r</span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">n</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">o</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">1</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> [</span><span style="color:#89DDFF;">!</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!</span><span style="color:#F78C6C;">1</span><span style="color:#F07178;">][</span><span style="color:#BABED8;">n</span><span style="color:#F07178;">]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">r</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">as</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">getRandomBoolean</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">o</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">as</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">getRandomNumber</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span></span></code></pre></div><p>这样其他开发者如果在使用过程中遇到了问题，就可以轻松找到插件作者的联系方式了！</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>请根据实际的 package.json 存在的字段信息调整 banner 内容。</p></div><h3 id="生成-npm-包的类型声明" tabindex="-1">生成 npm 包的类型声明 <a class="header-anchor" href="#生成-npm-包的类型声明" aria-label="Permalink to &quot;生成 npm 包的类型声明&quot;">​</a></h3><p>虽然到这里已经得到一个可以运行的 JavaScript Library 文件，在 JavaScript 项目里使用是完全没有问题的，但还不建议直接发布到 npmjs 上，因为目前的情况下在 TypeScript 项目并不能完全兼容，还需要生成一份 npm 包的类型声明文件。</p><h4 id="为什么需要类型声明" tabindex="-1">为什么需要类型声明 <a class="header-anchor" href="#为什么需要类型声明" aria-label="Permalink to &quot;为什么需要类型声明&quot;">​</a></h4><p>如果在上一小节 <a href="#关联本地软链接">关联本地软链接</a> 创建 Vue 调试项目时，也是使用了 TypeScript 版本的 Vue 项目，会遇到 VSCode 在下面这句代码上：</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">getRandomNumber</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@learning-vue3/lib</span><span style="color:#89DDFF;">&#39;</span></span></code></pre></div><p>在包名称 <code>&#39;@learning-vue3/lib&#39;</code> 的位置提示了一个红色波浪线，把鼠标移上去会显示这么一段话：</p><blockquote><p>无法找到模块 “@learning-vue3/lib” 的声明文件。 “D:/Project/demo/hello-lib/dist/index.cjs” 隐式拥有 &quot;any&quot; 类型。<br> 尝试使用 <code>npm i --save-dev @types/learning-vue3__lib</code> (如果存在)，或者添加一个包含 <code>declare module &#39;@learning-vue3/lib&#39;;</code> 的新声明 (.d.ts) 文件 ts(7016)</p></blockquote><p>此时在命令行运行 Vue 调试项目的打包命令 <code>npm run build</code> ，也会遇到打包失败的报错，控制台同样反馈了这个问题：缺少声明文件。</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">❯</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">run</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">build</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;"> hello-vue3@0.0.0 build</span></span>
<span class="line"><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;"> vue-tsc --noEmit </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">vite</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">build</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">src/App.vue:8:30</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">-</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">error</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">TS7016:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">Could</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">not</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">find</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">a</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">declaration</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">file</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">for</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">module</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@learning-vue3/lib</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">.</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">D:/Project/demo/hello-lib/dist/index.cjs</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">implicitly</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">has</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">an</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">any</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">type.</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#FFCB6B;">Try</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">`</span><span style="color:#FFCB6B;">npm</span><span style="color:#C3E88D;"> i --save-dev @types/learning-vue3__lib</span><span style="color:#89DDFF;">`</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">it</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">exists</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">or</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">add</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">a</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">new</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">declaration</span><span style="color:#BABED8;"> (.d.ts) file containing </span><span style="color:#89DDFF;">`</span><span style="color:#82AAFF;">declare</span><span style="color:#C3E88D;"> module </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@learning-vue3/lib</span><span style="color:#89DDFF;">&#39;;`</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">8</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">import</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">{</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">getRandomNumber</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">}</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@learning-vue3/lib</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#BABED8;">                               </span><span style="color:#FFCB6B;">~~~~~~~~~~~~~~~~~~~~</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">Found</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">1</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">error</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">in</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">src/App.vue:8</span></span></code></pre></div><p>虽然使用者可以按照报错提示，在调试项目下创建一个 <code>d.ts</code> 文件并写入以下内容来声明该 npm 包：</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">declare</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">module</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">@learning-vue3/lib</span><span style="color:#89DDFF;">&#39;</span></span></code></pre></div><p>但这需要每个使用者，或者说每个使用到这个包的项目都声明一次，对于使用者来说非常不友好， <code>declare module</code> 之后虽然不会报错了，但也无法获得 VSCode 对 npm 包提供的 API 进行 TS 类型的自动推导与类型提示、代码补全等功能支持。</p><h4 id="主流的做法" tabindex="-1">主流的做法 <a class="header-anchor" href="#主流的做法" aria-label="Permalink to &quot;主流的做法&quot;">​</a></h4><p>细心的开发者在 npmjs 网站上搜索 npm 包时，会发现很多 npm 包在详情页的包名后面，跟随有一个蓝色的 TS 图标，鼠标移上去时，还会显示一句提示语：</p><blockquote><p>This package contains built-in TypeScript declarations</p></blockquote><!----><p>例如上图的 <a href="https://www.npmjs.com/package/@vue/reactivity" target="_blank" rel="noreferrer">@vue/reactivity</a> ， Vue 3 的响应式 API 包，就带有这个图标。</p><p>这表示带有这个图标的 npm 包，已包含内置的 TypeScript 声明，可以获得完善的 TS 类型推导和提示支持，开发过程中也可以获得完善的代码补全功能支持，提高开发效率，在 TypeScript 项目执行 <code>npm run build</code> 的时候也能够被成功打包。</p><p>以 @vue/reactivity 这个包为例，如果项目下安装有这个 npm 包，可以在</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 基于项目根目录</span></span>
<span class="line"><span style="color:#FFCB6B;">./node_modules/@vue/reactivity/dist/reactivity.d.ts</span></span></code></pre></div><p>这个文件里查看 Vue 3 响应式 API 的类型声明，也可以通过该文件的 CDN 地址访问到其内容：</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">https://cdn.jsdelivr.net/npm/@vue/reactivity@3.2.40/dist/reactivity.d.ts</span></span></code></pre></div><h4 id="生成-dts-文件" tabindex="-1">生成 DTS 文件 <a class="header-anchor" href="#生成-dts-文件" aria-label="Permalink to &quot;生成 DTS 文件&quot;">​</a></h4><p>有在 “快速上手 TypeScript ” 一章阅读过 <a href="./typescript.html#了解-tsconfig-json">了解 tsconfig.json</a> 这节内容的开发者，应该对该文件有了一定的了解，如果还没有阅读过也没关系，可以先按照下方的步骤操作，接下来将分布说明如何生成 npm 包的 DTS 类型声明文件（以 <code>.d.ts</code> 为扩展名的文件）。</p><p>请先全局安装 <a href="https://www.npmjs.com/package/typescript" target="_blank" rel="noreferrer">typescript</a> 这个包：</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">install</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">-g</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">typescript</span></span></code></pre></div><p>依然是在在命令行界面，回到 hello-lib 这个 npm 包项目的根目录，执行以下命令生成 tsconfig.json 文件：</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">tsc</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">--init</span></span></code></pre></div><p>打开 tsconfig.json 文件，生成的文件里会有很多默认被注释掉的选项，请将以下几个选项取消注释，同时在 <code>compilerOptions</code> 字段的同级新增 <code>include</code> 字段，这几个选项都修改为如下配置：</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki material-theme-palenight has-highlighted-lines"><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">compilerOptions</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line highlighted"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">declaration</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">true,</span></span>
<span class="line highlighted"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">emitDeclarationOnly</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">true,</span></span>
<span class="line highlighted"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">declarationDir</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./dist</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line highlighted"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">include</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./src</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>其中 <code>compilerOptions</code> 三个选项的意思是： <code>.ts</code> 源文件不编译为 <code>.js</code> 文件，只生成 <code>.d.ts</code> 文件并输出到 dist 目录； <code>include</code> 选项则告诉 TypeScript 编译器，只处理 src 目录下的 TS 文件。</p><p>修改完毕后，在命令行执行以下命令，它将根据 tsconfig.json 的配置对项目进行编译：</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">tsc</span></span></code></pre></div><p>可以看到现在的 dist 目录下多了 2 份 <code>.d.ts</code> 文件： index.d.ts 和 utils.d.ts 。</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight has-highlighted-lines"><code><span class="line"><span style="color:#FFCB6B;">hello-lib</span></span>
<span class="line"><span style="color:#FFCB6B;">└─dist</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#FFCB6B;">├─index.cjs</span></span>
<span class="line highlighted"><span style="color:#BABED8;">  </span><span style="color:#FFCB6B;">├─index.d.ts</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#FFCB6B;">├─index.min.js</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#FFCB6B;">├─index.mjs</span></span>
<span class="line highlighted"><span style="color:#BABED8;">  </span><span style="color:#FFCB6B;">└─utils.d.ts</span></span></code></pre></div><p>打开 dist/index.d.ts ，可以看到它的内容和 src/index.ts 是一样的，因为作为入口文件，只提供了模块的导出：</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// dist/index.d.ts</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">*</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">./utils</span><span style="color:#89DDFF;">&#39;</span></span></code></pre></div><p>再打开 dist/utils.d.ts ，可以看到它的内容如下，对比 src/utils.ts 的文件内容，它去掉了具体的功能实现，并且根据代码逻辑，转换成了 TypeScript 的类型声明：</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// dist/utils.d.ts</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * 生成随机数</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * </span><span style="color:#89DDFF;font-style:italic;">@</span><span style="color:#C792EA;font-style:italic;">param</span><span style="color:#676E95;font-style:italic;"> </span><span style="color:#BABED8;font-style:italic;">min</span><span style="color:#676E95;font-style:italic;"> - 最小值</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * </span><span style="color:#89DDFF;font-style:italic;">@</span><span style="color:#C792EA;font-style:italic;">param</span><span style="color:#676E95;font-style:italic;"> </span><span style="color:#BABED8;font-style:italic;">max</span><span style="color:#676E95;font-style:italic;"> - 最大值</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * </span><span style="color:#89DDFF;font-style:italic;">@</span><span style="color:#C792EA;font-style:italic;">param</span><span style="color:#676E95;font-style:italic;"> </span><span style="color:#BABED8;font-style:italic;">roundingType</span><span style="color:#676E95;font-style:italic;"> - 四舍五入类型</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * </span><span style="color:#89DDFF;font-style:italic;">@</span><span style="color:#C792EA;font-style:italic;">returns</span><span style="color:#676E95;font-style:italic;"> 范围内的随机数</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">declare</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">function</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">getRandomNumber</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#BABED8;font-style:italic;">min</span><span style="color:#89DDFF;">?:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">number</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#BABED8;font-style:italic;">max</span><span style="color:#89DDFF;">?:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">number</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#BABED8;font-style:italic;">roundingType</span><span style="color:#89DDFF;">?:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">round</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">|</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ceil</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">|</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">floor</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">):</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">number</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * 生成随机布尔值</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">declare</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">function</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">getRandomBoolean</span><span style="color:#89DDFF;">():</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">boolean</span></span></code></pre></div><p>由于 hello-lib 项目的 package.json 已提前指定了类型声明文件指向：</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">types</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">dist/index.d.ts</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>因此可以直接回到调试 npm 包的 Vue 项目，此时 VSCode 对那句 import 语句的红色波浪线报错信息已消失不见，鼠标移到 <code>getRandomNumber</code> 这个方法上，也可以看到 VSCode 出现了该方法的类型提示，非常方便。</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>如果 VSCode 未能及时更新该包的类型，依然提示红色波浪线，可以重启 VSCode 再次查看。</p></div><p>再次运行 <code>npm run build</code> 命令构建调试项目，这一次顺利通过编译：</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">❯</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">run</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">build</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;"> hello-vue3@0.0.0 build</span></span>
<span class="line"><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;"> vue-tsc --noEmit </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">vite</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">build</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">vite</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">v2.9.15</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">building</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">for</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">production...</span></span>
<span class="line"><span style="color:#FFCB6B;">✓</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">42</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">modules</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">transformed.</span></span>
<span class="line"><span style="color:#FFCB6B;">dist/assets/logo.03d6d6da.png</span><span style="color:#BABED8;">             </span><span style="color:#F78C6C;">6.69</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">KiB</span></span>
<span class="line"><span style="color:#FFCB6B;">dist/index.html</span><span style="color:#BABED8;">                           </span><span style="color:#F78C6C;">0.42</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">KiB</span></span>
<span class="line"><span style="color:#FFCB6B;">dist/assets/home.9a123f29.js</span><span style="color:#BABED8;">              </span><span style="color:#F78C6C;">2.01</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">KiB</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">gzip:</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">1.01</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">KiB</span></span>
<span class="line"><span style="color:#FFCB6B;">dist/assets/logo.db8b6a93.js</span><span style="color:#BABED8;">              </span><span style="color:#F78C6C;">0.12</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">KiB</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">gzip:</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">0.13</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">KiB</span></span>
<span class="line"><span style="color:#FFCB6B;">dist/assets/TransferStation.25db7d3e.js</span><span style="color:#BABED8;">   </span><span style="color:#F78C6C;">0.29</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">KiB</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">gzip:</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">0.22</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">KiB</span></span>
<span class="line"><span style="color:#FFCB6B;">dist/assets/bar.0e9da4c4.js</span><span style="color:#BABED8;">               </span><span style="color:#F78C6C;">0.53</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">KiB</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">gzip:</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">0.37</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">KiB</span></span>
<span class="line"><span style="color:#FFCB6B;">dist/assets/bar.09e673fa.css</span><span style="color:#BABED8;">              </span><span style="color:#F78C6C;">0.22</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">KiB</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">gzip:</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">0.18</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">KiB</span></span>
<span class="line"><span style="color:#FFCB6B;">dist/assets/home.6bd02f2a.css</span><span style="color:#BABED8;">             </span><span style="color:#F78C6C;">0.62</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">KiB</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">gzip:</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">0.33</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">KiB</span></span>
<span class="line"><span style="color:#FFCB6B;">dist/assets/index.60726771.css</span><span style="color:#BABED8;">            </span><span style="color:#F78C6C;">0.47</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">KiB</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">gzip:</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">0.29</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">KiB</span></span>
<span class="line"><span style="color:#FFCB6B;">dist/assets/index.aebbe022.js</span><span style="color:#BABED8;">             </span><span style="color:#F78C6C;">79.87</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">KiB</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">gzip:</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">31.80</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">KiB</span></span></code></pre></div><h4 id="生成-dts-bundle" tabindex="-1">生成 DTS Bundle <a class="header-anchor" href="#生成-dts-bundle" aria-label="Permalink to &quot;生成 DTS Bundle&quot;">​</a></h4><p>从 <a href="#初始化项目">初始化项目</a> 到 <a href="#生成-dts-文件">生成 DTS 文件</a> ，其实已经走完一个 npm 包的完整开发流程了，是可以提交发布了，但在发布之前，先介绍另外一个生成 DTS 文件的方式，可以根据实际情况选择使用。</p><p>请注意这里使用了 DTS Bundle 来称呼类型声明文件，这是因为直接使用 tsc 命令生成的 DTS 文件，是和源码目录的文件数量挂钩的，可以留意到在上一小节使用 tsc 命令生成声明文件后，在 hello-lib 项目中：</p><ul><li>src 源码目录有 index.ts 和 utils.ts 两个文件</li><li>dist 输出目录也对应生成了 index.d.ts 和 utils.d.ts 两个文件</li></ul><p>在一个大型项目里，源码的目录和文件非常多，意味着 DTS 文件也是非常多，这样的输出结构并不是特别友好。</p><p>在讲 npm 包对类型声明 <a href="#主流的做法">主流的做法</a> 的时候，提到了 Vue 响应式 API 的 npm 包是提供了一个完整的 DTS 文件，它包含了所有 API 的类型声明信息：</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">./node_modules/@vue/reactivity/dist/reactivity.d.ts</span></span></code></pre></div><p>这种将多个模块的文件内容合并为一个完整文件的行为通常称之为 Bundle ，本小节将介绍如何生成这种 DTS Bundle 文件。</p><p>继续回到 hello-lib 这个 npm 包项目，由于 tsc 本身不提供类型文件的合并，所以需要借助第三方依赖来实现，比较流行的第三方包有： <a href="https://github.com/timocov/dts-bundle-generator" target="_blank" rel="noreferrer">dts-bundle-generator</a> 、 <a href="https://github.com/vytenisu/npm-dts" target="_blank" rel="noreferrer">npm-dts</a> 、 <a href="https://github.com/TypeStrong/dts-bundle" target="_blank" rel="noreferrer">dts-bundle</a> 、 <a href="https://github.com/SitePen/dts-generator" target="_blank" rel="noreferrer">dts-generator</a> 等等。</p><p>之前笔者在为公司开发 npm 工具包的时候都对它们进行了一轮体验，鉴于实际开发过程中遇到的一些编译问题，在这里选用问题最少的 dts-bundle-generator 进行开发演示，请先安装到 hello-lib 项目的 devDependencies ：</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">i</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">-D</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">dts-bundle-generator</span></span></code></pre></div><p>dts-bundle-generator 支持在 package.json 里配置一个 script ，通过命令的形式在命令行生成 DTS Bundle ，也支持通过 JavaScript / TypeScript 编写函数来执行文件的生成，鉴于实际开发过程中使用函数生成 DTS Bundle 的场景比较多（例如 Monorepo 会有生成多个 Bundle 的使用场景），因此这里以函数的方式进行演示。</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>在使用 Git 等版本控制系统时，如果多个独立项目之间有关联，会把这些项目的代码都存储在同一个代码仓库集中管理，此时这个大型代码仓库就被称之为 Monorepo （其中 Mono 表示单一， Repo 是存储库 Repository 的缩写），当下许多大型项目都基于这种方法管理代码， <a href="https://github.com/vuejs/core" target="_blank" rel="noreferrer">Vue 3</a> 在 GitHub 的代码仓库也是一个 Monorepo 。</p></div><p>请在 hello-lib 的根目录下，创建一个与 src 源码目录同级的 scripts 目录，用来存储源码之外的脚本函数。</p><p>将以下代码保存到 scripts 目录下，命名为 buildTypes.mjs ：</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// scripts/buildTypes.mjs</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">writeFileSync</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">fs</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">dirname</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">resolve</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">path</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">fileURLToPath</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">url</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">generateDtsBundle</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">dts-bundle-generator</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">async</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">function</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">run</span><span style="color:#89DDFF;">()</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// 默认情况下 `.mjs` 文件需要自己声明 __dirname 变量</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">__filename</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">fileURLToPath</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">meta</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">url</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">__dirname</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">dirname</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">__filename</span><span style="color:#F07178;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// 获取项目的根目录路径</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">rootPath</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">resolve</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">__dirname</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">..</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// 添加构建选项</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// 插件要求是一个数组选项，支持多个入口文件</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">options</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> [</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      filePath</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">resolve</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">rootPath</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">`</span><span style="color:#C3E88D;">./src/index.ts</span><span style="color:#89DDFF;">`</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      output</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        noBanner</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">  ]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// 生成 DTS 文件内容</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// 插件返回一个数组，返回的文件内容顺序同选项顺序</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">dtses</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">generateDtsBundle</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">options</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    preferredConfigPath</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">resolve</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">rootPath</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">`</span><span style="color:#C3E88D;">./tsconfig.json</span><span style="color:#89DDFF;">`</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">!</span><span style="color:#BABED8;">Array</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">isArray</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">dtses</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">||</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!</span><span style="color:#BABED8;">dtses</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">length</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;font-style:italic;">return</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// 将 DTS Bundle 的内容输出成 `.d.ts` 文件保存到 dist 目录下</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// 当前只有一个文件要保存，所以只取第一个下标的数据</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">dts</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">dtses</span><span style="color:#F07178;">[</span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">]</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">output</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">resolve</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">rootPath</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">`</span><span style="color:#C3E88D;">./dist/index.d.ts</span><span style="color:#89DDFF;">`</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#82AAFF;">writeFileSync</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">output</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">dts</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#82AAFF;">run</span><span style="color:#BABED8;">()</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">catch</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">e</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">e</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span></span></code></pre></div><p>接下来打开 hello-lib 的 package.json 文件，添加一个 <code>build:types</code> 的 script ，并在 <code>build</code> 命令中通过 <code>&amp;&amp;</code> 符号设置为继发执行任务，当前所有的 scripts 如下：</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">scripts</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">build</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">vite build &amp;&amp; npm run build:types</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">build:types</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">node scripts/buildTypes.mjs</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>继发执行：只有前一个任务执行成功，才继续执行下一个任务，任务与任务之间使用 <code>&amp;&amp;</code> 符号连接。</p></div><p>接下来再运行 <code>npm run build</code> 命令，将在执行完 Vite 的 build 任务之后，再继续执行 DTS Bundle 的文件生成，可以看到现在的 dist 目录变成了如下，只会生成一个 <code>.d.ts</code> 文件：</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight has-highlighted-lines"><code><span class="line"><span style="color:#FFCB6B;">hello-lib</span></span>
<span class="line"><span style="color:#FFCB6B;">└─dist</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#FFCB6B;">├─index.cjs</span></span>
<span class="line highlighted"><span style="color:#BABED8;">  </span><span style="color:#FFCB6B;">├─index.d.ts</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#FFCB6B;">├─index.min.js</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#FFCB6B;">└─index.mjs</span></span></code></pre></div><p>现在 index.d.ts 文件已经集合了源码目录下所有的 TS 类型，变成了如下内容：</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// dist/index.d.ts</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * 生成随机数</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * </span><span style="color:#89DDFF;font-style:italic;">@</span><span style="color:#C792EA;font-style:italic;">param</span><span style="color:#676E95;font-style:italic;"> </span><span style="color:#BABED8;font-style:italic;">min</span><span style="color:#676E95;font-style:italic;"> - 最小值</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * </span><span style="color:#89DDFF;font-style:italic;">@</span><span style="color:#C792EA;font-style:italic;">param</span><span style="color:#676E95;font-style:italic;"> </span><span style="color:#BABED8;font-style:italic;">max</span><span style="color:#676E95;font-style:italic;"> - 最大值</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * </span><span style="color:#89DDFF;font-style:italic;">@</span><span style="color:#C792EA;font-style:italic;">param</span><span style="color:#676E95;font-style:italic;"> </span><span style="color:#BABED8;font-style:italic;">roundingType</span><span style="color:#676E95;font-style:italic;"> - 四舍五入类型</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * </span><span style="color:#89DDFF;font-style:italic;">@</span><span style="color:#C792EA;font-style:italic;">returns</span><span style="color:#676E95;font-style:italic;"> 范围内的随机数</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">declare</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">function</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">getRandomNumber</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#BABED8;font-style:italic;">min</span><span style="color:#89DDFF;">?:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">number</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#BABED8;font-style:italic;">max</span><span style="color:#89DDFF;">?:</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">number</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#BABED8;font-style:italic;">roundingType</span><span style="color:#89DDFF;">?:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">round</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">|</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ceil</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">|</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">floor</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">):</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">number</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">/**</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> * 生成随机布尔值</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"> */</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">declare</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">function</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">getRandomBoolean</span><span style="color:#89DDFF;">():</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">boolean</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{}</span></span></code></pre></div><p>对于大型项目，将 DTS 文件集合为 Bundle 输出是一种主流的管理方式，非常建议使用这种方式来为 npm 包生成类型文件。</p><h3 id="添加说明文档" tabindex="-1">添加说明文档 <a class="header-anchor" href="#添加说明文档" aria-label="Permalink to &quot;添加说明文档&quot;">​</a></h3><p>作为一个完整的 npm 包，应该配备一份操作说明给使用者阅读，复杂的文档可以使用 VitePress 等文档程序独立部署，而简单的项目则只需要完善一份 README 即可。</p><p>请创建一个名为 README.md 的 Markdown 文件在项目根目录下，与 src 源码目录同级，该文件的文件名 README 推荐使用全大写，这是开源社区主流的命名方式，全大写的原因是为了与代码文件进行直观的区分。</p><p>编写 README 使用的 Markdown 是一种轻量级标记语言，可以使用易读易写的纯文本格式编写文档，以 <code>.md</code> 作为文件扩展名，当代码托管到 GitHub 仓库或者发布到 npmjs 等平台时， README 文件会作为项目的主页内容呈现。</p><p>为了方便学习，这里将一些常用的 Markdown 语法与 HTML 代码对比如下，可以看到书写方面非常的简洁：</p><table><thead><tr><th style="text-align:center;">Markdown 代码</th><th style="text-align:center;">HTML 代码</th></tr></thead><tbody><tr><td style="text-align:center;"><code># 一级标题</code></td><td style="text-align:center;"><code>&lt;h1&gt;一级标题&lt;/h1&gt;</code></td></tr><tr><td style="text-align:center;"><code>## 二级标题</code></td><td style="text-align:center;"><code>&lt;h2&gt;二级标题&lt;/h2&gt;</code></td></tr><tr><td style="text-align:center;"><code>### 三级标题</code></td><td style="text-align:center;"><code>&lt;h3&gt;三级标题&lt;/h3&gt;</code></td></tr><tr><td style="text-align:center;"><code>**加粗文本**</code></td><td style="text-align:center;"><code>&lt;span style=&quot;font-weight: bold;&quot;&gt;加粗文本&lt;/span&gt;</code></td></tr><tr><td style="text-align:center;"><code>[链接文本](https://example.com)</code></td><td style="text-align:center;"><code>&lt;a href=&quot;https://example.com&quot;&gt;链接文本&lt;/a&gt;</code></td></tr></tbody></table><p>更多的 Markdown 语法建议在 <a href="https://markdown.com.cn" target="_blank" rel="noreferrer">Markdown 教程网站</a> 上学习。</p><p>下面附上一份常用的 README 模板：</p><div class="language-md"><button title="Copy Code" class="copy"></button><span class="lang">md</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;"># </span><span style="color:#FFCB6B;">项目名称</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">写上项目用途的一句话简介。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">## </span><span style="color:#FFCB6B;">功能介绍</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">1.</span><span style="color:#BABED8;"> 功能 1 一句话介绍</span></span>
<span class="line"><span style="color:#89DDFF;">2.</span><span style="color:#BABED8;"> 功能 2 一句话介绍</span></span>
<span class="line"><span style="color:#89DDFF;">3.</span><span style="color:#BABED8;"> 功能 3 一句话介绍</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">## </span><span style="color:#FFCB6B;">在线演示</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">如果有部署在线 demo ，可放上 demo 的访问地址。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">## </span><span style="color:#FFCB6B;">安装方法</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">使用 npm ： </span><span style="color:#89DDFF;">`</span><span style="color:#C3E88D;">npm install package-name</span><span style="color:#89DDFF;">`</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">使用 CDN ： </span><span style="color:#89DDFF;">`</span><span style="color:#C3E88D;">https://example.com/package-name</span><span style="color:#89DDFF;">`</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">## </span><span style="color:#FFCB6B;">用法</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">告诉使用者如何使用 npm 包。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">## </span><span style="color:#FFCB6B;">插件选项</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">如果 npm 包是一个插件，并支持传递插件选项，在这里可以使用表格介绍选项的作用。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">|</span><span style="color:#BABED8;"> 选项名称 </span><span style="color:#89DDFF;">|</span><span style="color:#BABED8;">  类型  </span><span style="color:#89DDFF;">|</span><span style="color:#BABED8;">    作用    </span><span style="color:#89DDFF;">|</span></span>
<span class="line"><span style="color:#89DDFF;">|</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">:------:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">|</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">:----:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">|</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">:--------:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">|</span></span>
<span class="line"><span style="color:#89DDFF;">|</span><span style="color:#BABED8;">   foo    </span><span style="color:#89DDFF;">|</span><span style="color:#BABED8;"> string </span><span style="color:#89DDFF;">|</span><span style="color:#BABED8;"> 一句话介绍 </span><span style="color:#89DDFF;">|</span></span>
<span class="line"><span style="color:#89DDFF;">|</span><span style="color:#BABED8;">   bar    </span><span style="color:#89DDFF;">|</span><span style="color:#BABED8;"> number </span><span style="color:#89DDFF;">|</span><span style="color:#BABED8;"> 一句话介绍 </span><span style="color:#89DDFF;">|</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">更多内容请根据实际情况补充。</span></span></code></pre></div><p>拥有完善的使用说明文档，会让 npm 包更受欢迎！</p><h3 id="发布-npm-包" tabindex="-1">发布 npm 包 <a class="header-anchor" href="#发布-npm-包" aria-label="Permalink to &quot;发布 npm 包&quot;">​</a></h3><p>一个 npm 包开发完毕后，就可以进入发布阶段了，这一小节将讲解如何注册 npm 账号并发布到 npmjs 平台上供其他开发者下载使用。</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>在操作 npm 包发布之前，请先运行 <code>npm config rm registry</code> 命令取消 npm 镜像源的绑定，否则会发布失败，在 npm 包发布后，可以再重新 <a href="./guide.html#配置镜像源">配置镜像源</a> 。</p></div><h4 id="注册-npm-账号" tabindex="-1">注册 npm 账号 <a class="header-anchor" href="#注册-npm-账号" aria-label="Permalink to &quot;注册 npm 账号&quot;">​</a></h4><p>在发布 npm 包之前，请先在 npm 官网上注册一个账号：<a href="https://www.npmjs.com/signup" target="_blank" rel="noreferrer">点击注册</a> 。</p><p>接下来需要在命令行上登录该账号以操作发布命令，打开命令行工具，输入以下命令进行登录：</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">login</span></span></code></pre></div><p>按照命令行的提示输入在 npmjs 网站上注册的账号和密码即可完成登录，可以通过以下命令查看当前登录的账号名称，验证是否登录成功：</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">whoami</span></span></code></pre></div><p>在登录成功之后，命令行会记住账号的登录状态，以后的操作就无需每次都执行登录命令了。</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>以上操作也可以实用 <code>npm adduser</code> 命令代替，直接在命令行完成注册和登录。</p></div><h4 id="将包发布到-npmjs" tabindex="-1">将包发布到 npmjs <a class="header-anchor" href="#将包发布到-npmjs" aria-label="Permalink to &quot;将包发布到 npmjs&quot;">​</a></h4><p>在 npm 上发布私有包需要进行付费，因此这里只使用公共包的发布作为演示和讲解，如果开发的是公司内部使用的 npm 包，只要源代码是私有仓库，也可以使用这种方式来发布，当前在这样做之前请先获得公司的同意。</p><p>对于一个普通命名的包，要发布到 npmjs 上非常简单，只需要执行 npm 包管理器自带的一个命令即可：</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">publish</span></span></code></pre></div><p>它默认会将这个包作为一个公共包发布，如果包名称合法并且没有冲突，则发布成功，可以在 <a href="https://www.npmjs.com" target="_blank" rel="noreferrer">npmjs</a> 查询到，否则会返回错误信息告知原因，如果因为包名冲突导致的失败，可以尝试修改别的名称再次发布。</p><p>如果打算使用像 <a href="https://www.npmjs.com/package/@vue/cli" target="_blank" rel="noreferrer">@vue/cli</a> 、 <a href="https://www.npmjs.com/package/@vue/compiler-sfc" target="_blank" rel="noreferrer">@vue/compiler-sfc</a> 这样带有 @scope 前缀的作用域包名，需要先在 npmjs 的 <a href="https://www.npmjs.com/org/create" target="_blank" rel="noreferrer">创建新组织</a> 页面创建一个组织，或者确保自己拥有 @scope 对应的组织发布权限。</p><p>@scope 作用域包默认会作为私有包发布，因此在执行发布命令的时候还需要加上一个 <code>--access</code> 选项，将其指定为 <code>public</code> 允许公开访问才可以发布成功：</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">publish</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">--access</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">public</span></span></code></pre></div><p>当前的 hello-lib 项目已发布到 npmjs ，可以查看该包的主页 <a href="https://www.npmjs.com/package/@learning-vue3/lib" target="_blank" rel="noreferrer">@learning-vue3/lib</a> ，也可以通过 npm 安装到项目里使用了：</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">i</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">@learning-vue3/lib</span></span></code></pre></div><p>并且发布到 npmjs 上的包，都同时获得热门 CDN 服务的自动同步，可以通过包名称获取到 CDN 链接并通过 <code>&lt;script /&gt;</code> 标签引入到 HTML 页面里：</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 使用 jsDelivr CDN</span></span>
<span class="line"><span style="color:#FFCB6B;">https://cdn.jsdelivr.net/npm/@learning-vue3/lib</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 使用 UNPKG CDN</span></span>
<span class="line"><span style="color:#FFCB6B;">https://unpkg.com/@learning-vue3/lib</span></span></code></pre></div><p>此时 CDN 地址对应的 npm 包文件内容，就如前文所述，调用了 package.json 里 browser 字段指定的 UMD 规范文件 <code>dist/index.min.js</code> 。</p><h4 id="给-npm-包打-tag" tabindex="-1">给 npm 包打 Tag <a class="header-anchor" href="#给-npm-包打-tag" aria-label="Permalink to &quot;给 npm 包打 Tag&quot;">​</a></h4><p>细心的开发者还会留意到，例如像 Vue 这样的包，在 npmjs 上的 <a href="https://www.npmjs.com/package/vue?activeTab=versions" target="_blank" rel="noreferrer">版本列表</a> 里有 Current Tags 和 Version History 的版本分类，其中 Version History 是默认的版本发布历史列表，而 Current Tags 则是在发布 npm 包的时候指定打的标签。</p><!----><p>标签的好处是可以让使用者无需记住对应的版本号，而是使用一些更具备语义化的单词来安装指定版本，例如：</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 安装最新版的 Vue 3 ，即截图里对应的 3.2.40 版本</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">i</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">vue@latest</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 安装最新版的 Vue 2 ，即截图里对应的 2.7.10 版本</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">i</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">vue@v2-latest</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 如果后续有功能更新的测试版，也可以通过标签安装</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">i</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">vue@beta</span></span></code></pre></div><p>除了减少寻找版本号的麻烦外，一旦后续有版本更新，再次使用相同的标签安装，可以重新安装到该标签对应的最新版本，例如从 <code>1.0.0-beta.1</code> 升级到 <code>1.0.0-beta.2</code> ，可以使用 <code>@beta</code> 标签再次安装来达到升级的目的。</p><p>在标签列表里，有一个 <code>latest</code> 的标签是发布 npm 包时自带的，对应该包最新的正式版本，安装 npm 包时如果不指定标签，则默认使用 <code>latest</code> 标签，以下两个安装操作是等价的：</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># 隐式安装 latest 标签对应的版本</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">i</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">vue</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 显式安装 latest 标签对应的版本</span></span>
<span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">i</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">vue@latest</span></span></code></pre></div><p>同样的，当发布 npm 包时不指定标签，则该版本也会在发布后作为 <code>@latest</code> 标签对应的版本号。</p><p>其他标签则需要在发布时配合发布命令，使用 <code>--tag</code> 作为选项手动指定，以下命令将为普通包打上名为 <code>alpha</code> 的 Tag ：</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">publish</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">--tag</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">alpha</span></span></code></pre></div><p>同理，如果是 @scope 作用域包也是在使用 <code>--access</code> 选项的情况下，继续追加一条 <code>--tag</code> 选项指定包的标签。</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">npm</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">publish</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">--access</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">public</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">--tag</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">alpha</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>请注意，如果是 Alpha 或者 Beta 版本，通常会在版本号上增加 <code>-alpha.0</code> 、 <code>-alpha.1</code> 这样的 <a href="./guide.html#版本标识符">版本标识符</a>，以便在发布正式版本的时候可以使用无标识符的相同版本号，以保证版本号在遵循 <a href="./guide.html#基本格式与升级规则">升级规则</a> 下的连续性。</p></div><!----></div></div></main><footer class="VPDocFooter" data-v-f5bb20f4 data-v-23a86342><!--[--><!--]--><div class="edit-info" data-v-23a86342><div class="edit-link" data-v-23a86342><a class="VPLink link vp-external-link-icon no-icon edit-link-button" href="https://github.com/chengpeiquan/learning-vue3/edit/main/docs/plugin.md" target="_blank" rel="noreferrer" data-v-23a86342><!--[--><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" class="edit-link-icon" aria-label="edit icon" data-v-23a86342><path d="M18,23H4c-1.7,0-3-1.3-3-3V6c0-1.7,1.3-3,3-3h7c0.6,0,1,0.4,1,1s-0.4,1-1,1H4C3.4,5,3,5.4,3,6v14c0,0.6,0.4,1,1,1h14c0.6,0,1-0.4,1-1v-7c0-0.6,0.4-1,1-1s1,0.4,1,1v7C21,21.7,19.7,23,18,23z"></path><path d="M8,17c-0.3,0-0.5-0.1-0.7-0.3C7,16.5,6.9,16.1,7,15.8l1-4c0-0.2,0.1-0.3,0.3-0.5l9.5-9.5c1.2-1.2,3.2-1.2,4.4,0c1.2,1.2,1.2,3.2,0,4.4l-9.5,9.5c-0.1,0.1-0.3,0.2-0.5,0.3l-4,1C8.2,17,8.1,17,8,17zM9.9,12.5l-0.5,2.1l2.1-0.5l9.3-9.3c0.4-0.4,0.4-1.1,0-1.6c-0.4-0.4-1.2-0.4-1.6,0l0,0L9.9,12.5z M18.5,2.5L18.5,2.5L18.5,2.5z"></path></svg> 在 GitHub 上编辑本章内容<!--]--></a></div><!----></div><nav class="prev-next" data-v-23a86342><div class="pager" data-v-23a86342><a class="pager-link prev" href="/router.html" data-v-23a86342><span class="desc" data-v-23a86342>上一章</span><span class="title" data-v-23a86342>路由的使用</span></a></div><div class="pager" data-v-23a86342><a class="pager-link next" href="/communication.html" data-v-23a86342><span class="desc" data-v-23a86342>下一章</span><span class="title" data-v-23a86342>组件之间的通信</span></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter has-sidebar" data-v-2751e8a7 data-v-37be23df><div class="container" data-v-37be23df><p class="message" data-v-37be23df>Released under the MIT License.</p><p class="copyright" data-v-37be23df>Copyright © 2022-PRESENT 程沛权</p></div></footer><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"changelog.md\":\"a2735a6c\",\"efficient.md\":\"408092c4\",\"engineering.md\":\"2ee52a4c\",\"router.md\":\"d58211c6\",\"plugin.md\":\"0a2dbef2\",\"preface.md\":\"a8b0993a\",\"upgrade.md\":\"bae1c447\",\"links.md\":\"7d7479d1\",\"index.md\":\"fd4bbdcf\",\"communication.md\":\"03ba70fa\",\"typescript.md\":\"8bd7f79f\",\"guide.md\":\"b31602d8\",\"component.md\":\"b5101a34\",\"pinia.md\":\"d5fff388\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"zh-CN\",\"dir\":\"ltr\",\"title\":\"Vue3 入门指南与实战案例\",\"description\":\"这是一个关于 Vue 3 + TypeScript 的起步学习教程，适合完全的 Vue 新手和 Vue 2.0 的老手，在官方文档的基础上融入自己的一些实践经验。\",\"base\":\"/\",\"head\":[],\"appearance\":\"dark\",\"themeConfig\":{\"nav\":[{\"text\":\"购买纸质版\",\"link\":\"https://union-click.jd.com/jdc?e=jdext-1638352360249409536-0-1&p=JF8BARkJK1olXwQBUVpdAE8SAF8IGVMRXgICV24ZVxNJXF9RXh5UHw0cSgYYXBcIWDoXSQVJQwYAXFpeDEsUHDZNRwYlX1JEIQg5XCt0ZAlqUiVNX0FQACsWTkcbM28BG1kdXAcCU11tCEoWA2sNGFgTXDYyVFttWiXPtdnQvuoJiayNgdbKOEonA2gBGVkdXwEHVFdeAXsXC2s4zfWBiI69je743uG51uK4ztK-ibiEZG5tC3tMVjtBXkcVWgQLVlpeCkwWAGoAHlodWQQFSF9BCHsXAm4KE1gWWgQGOltdCUoVAGoBElh7XwcDVltdDksXAV8IK1glA2gDB1heWkweVgFVQgkdX00BHTBdDUgXAW4OHF8lXwcDVlxtOA\"},{\"text\":\"博客首页\",\"link\":\"https://chengpeiquan.com/\"},{\"text\":\"菜谱教程\",\"link\":\"https://github.com/chengpeiquan/cooking-cookbook\"}],\"sidebar\":[{\"text\":\"作者的话\",\"items\":[{\"text\":\"出版说明\",\"link\":\"/\"},{\"text\":\"前言\",\"link\":\"/preface\"}]},{\"text\":\"前端工程化入门教程\",\"items\":[{\"text\":\"了解前端工程化\",\"link\":\"/engineering\"},{\"text\":\"工程化的前期准备\",\"link\":\"/guide\"},{\"text\":\"快速上手 TypeScript\",\"link\":\"/typescript\"}]},{\"text\":\"Vue3 入门教程\",\"items\":[{\"text\":\"脚手架的升级与配置\",\"link\":\"/upgrade\"},{\"text\":\"单组件的编写\",\"link\":\"/component\"},{\"text\":\"路由的使用\",\"link\":\"/router\"},{\"text\":\"插件的开发和使用\",\"link\":\"/plugin\"},{\"text\":\"组件之间的通信\",\"link\":\"/communication\"},{\"text\":\"全局状态的管理\",\"link\":\"/pinia\"},{\"text\":\"高效开发\",\"link\":\"/efficient\"}]},{\"text\":\"扩展阅读\",\"items\":[{\"text\":\"常用文档\",\"link\":\"/links\"},{\"text\":\"更新记录\",\"link\":\"/changelog\"}]}],\"outline\":3,\"outlineTitle\":\"目录\",\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/chengpeiquan/learning-vue3\"}],\"editLink\":{\"pattern\":\"https://github.com/chengpeiquan/learning-vue3/edit/main/docs/:path\",\"text\":\"在 GitHub 上编辑本章内容\"},\"docFooter\":{\"prev\":\"上一章\",\"next\":\"下一章\"},\"footer\":{\"message\":\"Released under the MIT License.\",\"copyright\":\"Copyright © 2022-PRESENT 程沛权\"},\"algolia\":{\"appId\":\"5LYK75VPNC\",\"apiKey\":\"1d995a4b40491d50f3e8d607e5667017\",\"indexName\":\"chengpeiquan\",\"placeholder\":\"请输入关键词\"}},\"locales\":{},\"scrollOffset\":90,\"cleanUrls\":false}");</script>
    
  </body>
</html>